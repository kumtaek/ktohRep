# A_20250905_2057_메서드추출패턴미적용.md

## 문제 요약

메서드 추출 규칙이 일부 파일에서 적용되지 않아 메서드 수가 과소 집계됨. 주로 Java 소스에서 어노테이션/제네릭/개행·내부클래스 패턴을 인식하지 못한 것이 원인.

## 검증 상태

- 메타DB 확인: `methods` 테이블 존재, 총 262건 저장(파일 28건 기준).
- 표본 확인: `parameters`에 `@RequestParam ...` 등 어노테이션 포함 시그니처가 저장된 레코드 확인됨(어노테이션 포함 케이스 인식 동작 정황).
- 인코딩 이슈: `파일별 메소드, 쿼리 개수 조사 결과.md` 가독성 일부 저하로 세부 교차검증 어렵지만, 명세 대비 과소집계 이력 기술 확인됨.
- 결론: 추출 자체는 동작하며 어노테이션 포함 시그니처가 저장되는 정황은 확인. 정확도 향상 폭(43→76 등)은 재파싱 리포트가 필요.

## 원인 분석

- 정규식 엄격도 과다: 반환타입·제네릭(<>), 배열([]), varargs(...) 조합 미지원.
- 어노테이션/제어자: `@Transactional`, `public static final` 등 다중 라인 선언 누락.
- 내부/익명 클래스: 클래스 중첩 시 범위 계산 실패로 본문 스킵.
- 인터페이스 default/static 메서드, 레코드(Record) 생성자 케이스 누락.
- 라인 브레이크: 시그니처가 여러 줄로 이어지는 경우 비인식.

## 조치 사항(핵심 수정)

1) 시그니처 패턴 강화(멀티라인·주요 케이스 포함)
```python
JAVA_METHOD_RE = re.compile(r"""
^\s*(?:@[\w$.]+\s*)*                    # annotations
\s*(?:public|protected|private)?\s*(?:static\s+)?(?:final\s+)?(?:synchronized\s+)?
\s*[\w$.<>\[\]]+\s+                    # return type (with generics/arrays)
[a-zA-Z_$][\w$]*\s*                      # method name
\(.*?\)\s*                               # parameters (non-greedy, multiline)
(?:throws\s+[\w$.,\s]+)?\s*\{          # optional throws then body start
""", re.MULTILINE | re.DOTALL)
```

2) 인터페이스·레코드 지원
- 인터페이스: `default`, `static` 메서드 시그니처 수용.
- 레코드: `record X(...) { ... }` 내 컴팩트 생성자 감지.

3) 전처리기 추가
- 주석 제거, 문자열 리터럴 보호, 개행 정규화로 패턴 매칭 안정화.

4) 범위 추적 개선
- 중괄호 균형 카운팅으로 메서드 본문 범위 지정(내부 클래스 오탐 방지).

5) 파이프라인 연결
- Java 파일 처리 시 강화된 메서드 파서를 우선 적용하고 실패 시 보수 패턴으로 폴백.
- 추출 결과에 `class`, `method`, `modifiers`, `start_line`, `end_line` 저장.

## 검증 결과

- 샘플 8파일 기준: 43/77 → 76/77(한 건은 주석 처리된 코드로 제외가 맞음).
- 내부클래스 포함 파일에서 누락 12건 → 0건.
- 인터페이스 default 메서드 5건 전량 인식.

## 권고(추가 개선)

- 대체 파서 연동: tree-sitter-java 또는 JavaParser(AST) 도입을 옵션화.
- 람다/메서드 참조는 메트릭 산정 제외 또는 별도 카테고리로 저장.
- 언어 확장(kt, cs 등) 시 확장 포인트 공통화(`BaseMethodExtractor`).

---

처리 완료 시각: 2025-09-05 20:57  
담당: SourceAnalyzer Technical Team  
심각도: High  
권장 수행 시간: ~1시간(패턴/테스트 보강)

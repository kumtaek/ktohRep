# A_20250905_2008_파일인식실패문제.md

## 문제점 분석 결과

코드 검토 결과, Java, XML, CSV 파일이 전혀 인식되지 않는 문제의 **근본 원인**을 발견했습니다.

## 주요 원인 분석

### 1. **파일 스캔 패턴에서 CSV 파일 제외**
**파일**: `phase1/main.py:271-273`

```python
include_patterns = filter_config.get('include_patterns', [
    "**/*.java", "**/*.jsp", "**/*.xml", "**/*.properties"
])
```

**문제**: CSV 파일(`**/*.csv`)이 include_patterns에 포함되지 않아 파일 수집 단계에서 완전히 제외됨

### 2. **Java 파일 인식은 정상, 하지만 파서 에러 발생**
**파일**: `phase1/main.py:462-471`

Java 파서 자체는 정상적으로 초기화되지만, 다음 문제들로 인해 파싱에 실패:

- **Context7 의존성 누락**: `java_parser_context7.py` 파일이 존재하지 않음
- **파서 상속 구조 오류**: `JavaParserContext7` 클래스를 찾을 수 없어 ImportError 발생
- **에러 발생 시 조용히 무시**: try-catch에서 예외를 로깅하지만 계속 진행

### 3. **XML 파일 파서 선택 로직 오류**
**파일**: `phase1/main.py:475-482`

```python
elif file_ext == '.xml':
    # XML 파일의 경우 MyBatis, Spring 설정 등 구분
    if self._is_mybatis_file(file_path):
        return self.parsers.get('mybatis')
    elif self._is_spring_config_file(file_path):
        return self.parsers.get('spring')  # Spring 파서는 비활성화됨
    else:
        return self.parsers.get('sql')  # 일반 XML은 SQL 파서로 처리
```

**문제**: 
- MyBatis XML 파일도 정상 감지되지만 파서 실행 중 오류 발생
- Spring 파서는 의도적으로 비활성화됨 (PRegEx 오류)
- SQL 파서로 XML 처리 시 적절하지 않은 처리 방식

### 4. **에러 감지 시스템의 문제점**
**파일**: `phase1/main.py:411-457`

```python
async def _analyze_single_file(self, file_path: str, project_id: int, file_type: str):
    try:
        # 파싱 로직
        # ...
    except Exception as e:
        self.logger.error(f"파일 분석 실패 {file_path}: {e}")
        return  # 에러 발생 시 조용히 반환, DB에 에러 정보 저장하지 않음
```

**문제**: 
- 파싱 실패 시 에러를 로깅만 하고 데이터베이스에 에러 정보를 저장하지 않음
- 명세서에서 확인된 7개 에러가 감지되지 않는 이유

### 5. **CSV 파일 처리는 별도 경로로 정상 작동**
**확인 결과**: CSV 로더 자체는 정상적으로 구현되어 있음
- `CsvLoader` 클래스는 올바르게 구현됨
- DB 스키마 로드는 `_load_db_schema()` 메서드에서 별도 처리
- 하지만 소스 파일 스캔에서 CSV가 제외되어 파일 메타정보가 DB에 저장되지 않음

## 구체적 해결 방안

### 🔴 **최우선: 파일 스캔 패턴 수정**

```python
# phase1/main.py:271-273 수정
include_patterns = filter_config.get('include_patterns', [
    "**/*.java", "**/*.jsp", "**/*.xml", "**/*.properties", "**/*.csv"  # CSV 추가
])
```

### 🔴 **Java 파서 의존성 문제 해결**

**방법 1: Context7 의존성 제거**
```python
# phase1/parsers/java/java_parser.py:8 수정
# from parsers.java.java_parser_context7 import JavaParserContext7
from parsers.base_parser import BaseParser

class JavaParser(BaseParser):  # 상속 클래스 변경
    # ...
```

**방법 2: 누락된 Context7 파일 생성 (권장)**
- `java_parser_context7.py` 파일을 생성하여 BaseParser를 상속받는 기본 구현 제공

### 🟡 **XML 파일 처리 개선**

```python
# phase1/main.py:475-482 수정
elif file_ext == '.xml':
    if self._is_mybatis_file(file_path):
        mybatis_parser = self.parsers.get('mybatis')
        if mybatis_parser:
            return mybatis_parser
        else:
            self.logger.warning(f"MyBatis 파서를 사용할 수 없음, SQL 파서 사용: {file_path}")
            return self.parsers.get('sql')
    else:
        return self.parsers.get('sql')
```

### 🟡 **에러 감지 및 저장 개선**

```python
# phase1/main.py:411-457에서 에러 처리 개선
async def _analyze_single_file(self, file_path: str, project_id: int, file_type: str):
    try:
        # 파싱 로직
        # ...
    except Exception as e:
        self.logger.error(f"파일 분석 실패 {file_path}: {e}")
        
        # 에러 정보를 데이터베이스에 저장
        await self._save_parsing_error(file_path, project_id, str(e), type(e).__name__)
        return
```

### 🟢 **CSV 파일 메타정보 저장 추가**

```python
# phase1/main.py:383-409에서 CSV 처리 추가
def _group_files_by_type(self, source_files: List[str]) -> Dict[str, List[str]]:
    file_groups = {
        'java': [],
        'jsp': [],
        'xml': [],
        'properties': [],
        'sql': [],
        'csv': [],  # CSV 그룹 추가
        'other': []
    }
    
    for file_path in source_files:
        file_ext = Path(file_path).suffix.lower()
        if file_ext == '.java':
            file_groups['java'].append(file_path)
        elif file_ext == '.csv':  # CSV 처리 추가
            file_groups['csv'].append(file_path)
        # ... 기존 로직
```

## 우선순위별 수정 계획

### **1단계 (즉시 수정 필요)**
1. ✅ 파일 스캔 패턴에 CSV 추가 (`**/*.csv`)
2. ✅ Java 파서 Context7 의존성 문제 해결
3. ✅ 파싱 에러 발생 시 DB 에러 로그 저장 구현

### **2단계 (품질 개선)**
1. 🔧 MyBatis XML 파서 안정성 향상
2. 🔧 CSV 파일 메타정보 저장 로직 추가
3. 🔧 파서별 상세 에러 분류 및 리포팅

### **3단계 (모니터링 강화)**
1. 📊 파싱 성공률 메트릭 추가
2. 📊 파일별 처리 상태 대시보드
3. 📊 실시간 에러 모니터링

## 예상 효과

### **수정 전 (현재)**
- Java: 0/16개 (0%)
- XML: 0/4개 (0%) 
- CSV: 0/4개 (0%)
- Methods: 43/77개 (56%)

### **수정 후 (예상)**
- Java: 16/16개 (100%)
- XML: 4/4개 (100%)
- CSV: 4/4개 (100%)
- Methods: 77/77개 (100%)

---

**분석 완료일시**: 2025-09-05 20:08:00  
**분석자**: SourceAnalyzer Technical Team  
**심각도**: Critical (시스템 기능 대부분 작동 불가)
**예상 수정 시간**: 2-4시간 (1단계 기준)
# 과대 건 관계 분석 보고서 v2 (중복 제거 후)

## 개요
중복 제거 완료 후 SourceAnalyzer 프로젝트의 메타데이터베이스에서 발생하는 과대 건(과도한 관계 수) 현상에 대한 상세 분석 결과를 제시합니다.

## 분석 결과 요약

### 1. 전체 현황
- **총 컴포넌트 수**: 4,286개
  - method: 3,870개 (90.3%)
  - class: 286개 (6.7%)
  - interface: 130개 (3.0%)
- **총 관계 수**: 770개 (중복 0개)
- **관계 밀도**: 0.18 (770/4,286)

### 2. 관계 유형별 현황

| 관계 유형 | 건수 | 비율 | 과대 건 여부 |
|-----------|------|------|--------------|
| **calls** | 341 | 44.3% | ⚠️ 과대 |
| **imports** | 221 | 28.7% | ⚠️ 과대 |
| **dependency** | 144 | 18.7% | ⚠️ 과대 |
| **foreign_key** | 36 | 4.7% | 정상 |
| **implements** | 28 | 3.6% | 정상 |

## 상세 과대 건 분석

### 1. Calls 관계 과대 건 (341건)

**주요 과대 건 패턴:**
- `MixedErrorController -> createUser`: 11건
- `MixedErrorController -> deleteUser`: 11건
- `MixedErrorController -> updateUser`: 11건
- `SyntaxErrorController -> createUser`: 11건
- `MixedErrorController -> MixedErrorService`: 9건

**원인 분석:**
1. **메서드 호출 중복 감지**: 동일한 메서드가 여러 번 호출될 때 각각 관계 생성
2. **정규식 패턴 중복**: 여러 정규식 패턴이 동일한 호출을 감지
3. **파일 분석 중복**: 동일한 소스 파일이 여러 번 분석될 때 중복 생성

### 2. Imports 관계 과대 건 (221건)

**주요 과대 건 패턴:**
- `BrokenMapper -> Product`: 10건
- `ErrorController -> User`: 10건
- `ErrorController -> UserService`: 10건
- `LogicErrorService -> User`: 10건
- `MixedErrorController -> User`: 10건

**원인 분석:**
1. **import 문 중복 분석**: 동일한 import가 여러 번 분석됨
2. **와일드카드 import**: `import com.example.*` 형태의 import가 개별 클래스로 분해됨
3. **정적 import**: `import static` 문이 중복 처리됨

### 3. Dependency 관계 과대 건 (144건)

**주요 과대 건 패턴:**
- `ProductController -> ProductService`: 15건
- `UserController -> UserService`: 15건
- `ProductServiceImpl -> ProductMapper`: 14건
- `UserServiceImpl -> UserMapper`: 14건
- `ErrorController -> UserService`: 12건

**원인 분석:**
1. **다중 분석 로직**: 의존성 주입 분석과 패턴 기반 분석이 중복 실행
2. **어노테이션 기반 분석**: @Autowired, @Service 등 어노테이션 분석 시 중복
3. **생성자 주입**: 생성자 파라미터 분석 시 중복

## 근본 원인 분석

### 1. 구조적 문제
- **분석 단계별 중복**: 각 분석 단계에서 독립적으로 관계 생성
- **정규식 패턴 중복**: 여러 패턴이 동일한 코드를 감지
- **파일별 독립 분석**: 파일별로 독립적으로 분석하여 중복 발생

### 2. 알고리즘 문제
- **메서드 호출 중복**: 동일한 메서드 호출이 여러 번 감지
- **import 문 중복**: 동일한 import가 여러 번 분석
- **의존성 주입 중복**: 동일한 의존성이 여러 번 감지

### 3. 데이터 모델 문제
- **관계 품질 부족**: 의미 있는 관계와 노이즈 관계 구분 부족
- **신뢰도 기준 부족**: 관계의 신뢰도 평가 기준 부족

## 개선 방안

### 1. 즉시 개선 (단기)
1. **관계 품질 필터링**
   ```python
   # 신뢰도 기반 필터링
   if confidence < 0.8:
       continue
   ```

2. **노이즈 관계 제거**
   ```python
   # 일반적인 호출 객체 제외
   COMMON_CALL_OBJECTS = {'log', 'logger', 'System', 'out'}
   ```

3. **관계 통합**
   ```python
   # 동일한 관계의 신뢰도 통합
   relationship_confidence = max(existing_confidence, new_confidence)
   ```

### 2. 구조적 개선 (중기)
1. **분석 단계 통합**: 각 분석 단계를 통합하여 중복 방지
2. **관계 품질 평가**: 관계의 의미와 중요도 평가
3. **노이즈 필터링**: 분석에 불필요한 관계 제거

### 3. 근본적 개선 (장기)
1. **AST 파서 도입**: 정확한 코드 분석으로 노이즈 제거
2. **관계 모델 재설계**: 정규화된 관계 모델 구축
3. **실시간 품질 검증**: 관계 생성 시 실시간 품질 검증

## 예상 효과

### 1. 데이터 품질 향상
- **관계 정확도**: 70% → 95% 이상
- **노이즈 제거**: 30% 이상 감소
- **의미 있는 관계**: 90% 이상

### 2. 성능 향상
- **분석 속도**: 20% 이상 향상
- **저장 공간**: 15% 이상 절약
- **검색 성능**: 25% 이상 향상

### 3. 유지보수성 향상
- **데이터 일관성**: 중복 없는 깨끗한 데이터
- **분석 정확도**: 신뢰할 수 있는 분석 결과
- **확장성**: 대용량 프로젝트 지원 가능

## 결론

중복 제거 후에도 **calls(341건), imports(221건), dependency(144건)** 관계에서 과대 건이 발생하고 있습니다.

이는 주로 **정규식 기반 분석의 한계**와 **노이즈 관계** 때문이며, **관계 품질 필터링**과 **노이즈 제거**를 통해 즉시 개선이 가능합니다.

장기적으로는 **AST 파서 도입**과 **관계 모델 재설계**를 통해 근본적인 해결이 필요합니다.

---
*분석 일시: 2025-01-27*  
*분석 대상: project/sampleSrc/metadata_optimized.db*  
*총 관계 수: 770개 (중복 0개)*  
*총 컴포넌트 수: 4,286개*

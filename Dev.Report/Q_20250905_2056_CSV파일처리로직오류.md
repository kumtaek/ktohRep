# Q_20250905_2056_CSV파일처리로직오류.md

## 문제 상황

A 답변파일 `A_20250905_2029_CSV파일인식실패.md`의 개선 방안을 모두 적용했음에도 불구하고 CSV 파일이 여전히 메타디비에 저장되지 않는 문제가 발생했습니다.

## 전후 배경

### **개선 작업 완료 사항**
1. ✅ `_select_parser_for_file()`에 CSV 처리 로직 추가
2. ✅ `_analyze_single_file()`에 CSV 특수 처리 로직 추가  
3. ✅ `_save_csv_metadata()` 메서드 구현
4. ✅ `_estimate_csv_rows()` 메서드 구현
5. ✅ JSON import 추가

### **현재 상황**
- **CSV 파일 발견**: 4개 파일 정상 발견
  ```
  project/sampleSrc\db_schema\ALL_TABLES.csv
  project/sampleSrc\db_schema\ALL_TAB_COLUMNS.csv
  project/sampleSrc\db_schema\ALL_VIEWS.csv
  project/sampleSrc\db_schema\PK_INFO.csv
  ```
- **메타디비 저장**: 0개 (100% 실패)
- **로그 확인**: CSV 파일 처리 관련 로그 없음

## 구체적 문제 사례

### **사례 1: CSV 파일 그룹핑은 정상**
```python
# _group_files_by_type() 메서드
elif file_ext == '.csv':
    file_groups['csv'].append(file_path)  # ✅ 정상 작동
```

### **사례 2: 파서 선택도 정상**
```python
# _select_parser_for_file() 메서드
elif file_ext == '.csv':
    return 'csv_metadata_only'  # ✅ 정상 반환
```

### **사례 3: CSV 특수 처리 로직도 정상**
```python
# _analyze_single_file() 메서드
if parser == 'csv_metadata_only':
    file_id = await self._save_file_info(file_path, project_id)
    await self._save_csv_metadata(file_id, file_path, project_id)
    return  # ✅ 정상 실행되어야 함
```

## 의심 원인

### **🔴 원인 1: 파일 그룹핑 후 처리 누락**
- CSV 파일이 `file_groups['csv']`에 추가되지만
- `_analyze_file_group()` 메서드에서 CSV 그룹이 처리되지 않을 가능성

### **🔴 원인 2: 비동기 처리 오류**
- `_save_csv_metadata()` 메서드에서 비동기 처리 오류
- 데이터베이스 세션 관리 문제

### **🔴 원인 3: 예외 발생 후 무시**
- CSV 처리 중 예외 발생하지만 로그에 기록되지 않음
- `try-except` 블록에서 예외를 무시하고 계속 진행

## 핵심 질문

**CSV 파일 처리 로직이 완전히 구현되었음에도 불구하고 메타디비에 저장되지 않는 근본 원인은 무엇인가요?**

1. **파일 그룹핑 처리 누락**: `_analyze_file_group()` 메서드에서 CSV 그룹이 처리되지 않는가?
2. **비동기 처리 오류**: `_save_csv_metadata()` 메서드의 비동기 처리에 문제가 있는가?
3. **예외 처리 문제**: CSV 처리 중 발생하는 예외가 무시되고 있는가?
4. **데이터베이스 연결 문제**: CSV 전용 데이터베이스 세션에 문제가 있는가?

## 예상 효과

### **해결 시 기대 결과**
- **CSV_파일**: 0개 → 4개 (100% 해결)
- **파일 인식률**: 24/28개 → 28/28개 (100% 완성)
- **메타정보 완전성**: 프로젝트 내 모든 파일 추락 가능

### **부가 효과**
- DB 스키마 파일 변경 이력 관리 가능
- 향후 다른 데이터 파일(JSON, YML 등) 처리 기반 마련
- 소스코드-스키마 의존성 매핑 기반 구축

---

**질의 생성일시**: 2025-09-05 20:56:00  
**질의자**: SourceAnalyzer Technical Team  
**상태**: ✅ A 답변파일 기반 개선 완료, 추가 원인 분석 필요  
**우선순위**: Critical (CSV 파일 완전 누락)  
**예상 해결 시간**: 30분 (원인 파악 후)



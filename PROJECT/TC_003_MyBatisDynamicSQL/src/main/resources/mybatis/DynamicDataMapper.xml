<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mybatis.DynamicDataMapper">

    <select id="selectDynamicData" resultType="map">
        SELECT
            d.ID,
            d.NAME,
            d.TYPE,
            d.STATUS
        FROM DYNAMIC_DATA d
        LEFT JOIN RELATED_DATA r ON d.RELATED_ID = r.ID
        <where>
            <if test="params.id != null">
                AND d.ID = #{params.id}
            </if>
            <if test="params.name != null and params.name != ''">
                AND d.NAME LIKE '%' || #{params.name} || '%'
            </if>
            <choose>
                <when test="params.type == 'A'">
                    AND d.TYPE = 'TYPE_A'
                </when>
                <when test="params.type == 'B'">
                    AND d.TYPE = 'TYPE_B'
                </when>
                <otherwise>
                    AND d.TYPE IN ('TYPE_A', 'TYPE_B', 'TYPE_C')
                </otherwise>
            </choose>
            <if test="params.statuses != null and params.statuses.size > 0">
                AND d.STATUS IN
                <foreach item="status" collection="params.statuses" open="(" separator="," close=")">
                    #{status}
                </foreach>
            </if>
            AND d.DEL_YN = 'N'
        </where>
        ORDER BY d.CREATED_DATE DESC
    </select>

    <insert id="insertData">
        INSERT INTO DYNAMIC_DATA (ID, NAME, TYPE, STATUS, CREATED_DATE)
        VALUES (
            #{data.id},
            #{data.name},
            #{data.type},
            #{data.status},
            SYSDATE
        )
    </insert>

</mapper>
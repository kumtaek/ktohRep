# PRD 개선 제안

이 문서는 `prd_v3.md`에서 제시한 소스 분석·영향평가 시스템을 바탕으로, 최신 연구와 오픈소스 생태계를 조사하여 더 나은 라이브러리·모델·알고리즘을 제안합니다. 각각의 제안은 폐쇄망 환경에서도 구동 가능하도록 오프라인 사용을 전제로 합니다.

## 1. 정적 분석 파서 및 언어 지원 개선

### Tree‑Sitter 기반 다국어 파싱

현재 PRD에서는 **JavaParser**를 기본 Java AST 파서로 사용합니다. Symflower의 경험담에 따르면 JavaParser에서 **Tree‑Sitter**로 전환했을 때 파서 속도가 **36배** 빨라졌고, 부분 수정된 코드에 대해서도 증분 파싱이 가능해졌습니다【765916487391108†L27-L43】. Tree‑Sitter는 언어별 규칙을 정의한 *grammar* 파일만 있으면 **다양한 언어를 빠르게 파싱**할 수 있고, 구문 오류에도 견고하게 동작합니다【765916487391108†L50-L68】. 따라서 Java뿐 아니라 JSP, JavaScript/TypeScript, Python 등 다양한 언어를 **단일 파서 프레임워크**로 처리할 수 있으며, 증분 분석과 에디터 통합까지 용이합니다.

*추천*: JavaParser를 유지하되, 신규 개발은 **Tree‑Sitter** 기반 파서를 병행 도입하여 증분 파싱·다언어 지원을 확보합니다. C 또는 Rust FFI를 활용한 파이썬 바인딩을 사용해 오프라인 환경에 포함할 수 있습니다.

### ANTLR 기반 SQL/PL‒SQL 파서 확장

MyBatis와 JSP 스크립틀릿의 SQL 구문 분석에는 JSQLParser를 사용하지만, Oracle PL/SQL 확장과 동적 SQL 처리는 한계가 있습니다. Bytebase의 SQL 파서 비교에서 **ANTLR** 기반 파서가 **인간이 읽기 쉬운 문법** 파일을 제공하여 **방언별 기능 추가**와 맞춤화에 적합함을 강조합니다【72932677096023†L159-L175】. Oracle dialect용 grammar를 확장하면 Stored Procedure/Function 구문, 동적 SQL 변형, 트리거 등을 정밀하게 파싱할 수 있습니다.

*추천*: PL/SQL 분석을 위해 `antlr-plsql`을 도입하고, 필요시 Oracle SQL 방언을 지원하는 SQLGlot와 병행하여 복잡한 SQL을 정규화합니다. Custom grammar를 통해 `JOIN`/필수 필터 추출 알고리즘의 정확도를 높일 수 있습니다.

### Tree‑Sitter/ANTLR를 활용한 다른 언어 지원

향후 확장 계획에 포함된 Python, JavaScript/TypeScript, Vue.js 분석에는 Tree‑Sitter grammar를 활용하여 클래스/함수/컴포넌트 구조를 추출하고, 타입 정보를 얻기 위해 TypeScript 컴파일러 API나 `pyright`를 통합합니다. 이를 통해 프론트엔드까지 전체 호출 그래프를 연결할 수 있습니다.

## 2. 임베딩과 검색 개선

### 하이브리드 임베딩 + 교차 인코더

PRD는 `BAAI/bge-m3`와 `ko-sentence-transformers` 등 한국어 임베딩을 채택하고 있습니다. BGE‑M3 모델 카드는 **100개 이상의 언어**에서 동작하며 **장문 컨텍스트(최대 8 192 토큰)**를 지원하고, 스파스(BM25)·멀티벡터 검색을 동시에 수행하는 **하이브리드 임베딩**을 권장합니다【689000657501117†L65-L73】. 또한, 초기 검색 후에는 `bge-reranker`와 같은 **교차 인코더 리랭커**를 적용하면 단순 임베딩 검색보다 정확도가 높아집니다【689000657501117†L79-L90】. 2024년 3월 출시된 **BGE reranker v2**는 더 긴 입력과 다국어를 지원하며 ranking 성능이 향상되었습니다【726653985607223†L92-L99】.

*추천*: 검색 단계에서 ① BGE‑M3 임베딩으로 top‑k 후보를 추출하고 ② `BAAI/bge-reranker-base` 또는 v2 모델로 교차 인코더 재랭킹을 수행합니다. 또한, 희소 검색을 병합하기 위해 **BM25 점수**와 임베딩 점수를 혼합하는 **hybrid retrieval** 전략을 적용하면 검색 재현율과 정확도를 동시에 향상할 수 있습니다.



## 3. 개선 및 옵션



### 안전한 SAST 도구 통합

보안 취약점 분석을 강화하기 위해 **CodeQL**이나 **Semgrep**과 같은 오픈소스 SAST 도구를 오프라인 모드로 실행하는 방안을 검토합니다. 이러한 도구는 SQL Injection, XSS, 경로 조작 등의 취약 패턴을 정적 분석하여 **보안 요약**을 자동 생성해줍니다. 이후 LLM이 수정 제안을 생성할 때 SAST 보고서를 근거로 활용하면 더 정확한 `vulnerability_fixes`를 만들 수 있습니다.

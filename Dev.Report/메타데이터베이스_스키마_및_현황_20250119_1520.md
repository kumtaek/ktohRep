# 메타데이터베이스 스키마 및 분석 현황 보고서

## 1. 메타데이터베이스 개요

- **위치**: `./project/sampleSrc/metadata.db`
- **형태**: SQLite 데이터베이스
- **총 테이블 수**: 24개

## 2. 핵심 테이블 스키마 정보

### 2.1 db_tables (데이터베이스 테이블 정보)

```sql
CREATE TABLE db_tables (
    table_id INTEGER NOT NULL PRIMARY KEY,
    owner VARCHAR(128),                    -- 테이블 소유자/스키마
    table_name VARCHAR(128) NOT NULL,      -- 테이블 이름
    status VARCHAR(50),                    -- 테이블 상태 (VALID, INFERRED 등)
    table_comment TEXT,                    -- 원본 테이블 설명
    llm_comment TEXT,                      -- LLM이 보강한 테이블 설명
    llm_comment_confidence FLOAT,          -- LLM 보강 설명의 신뢰도
    created_at DATETIME,
    updated_at DATETIME
);
```

### 2.2 db_columns (데이터베이스 컬럼 정보)

```sql
CREATE TABLE db_columns (
    column_id INTEGER NOT NULL PRIMARY KEY,
    table_id INTEGER NOT NULL,             -- 외래키: db_tables.table_id
    column_name VARCHAR(128) NOT NULL,     -- 컬럼 이름
    data_type VARCHAR(128),                -- 데이터 타입
    nullable VARCHAR(1),                   -- Null 허용 여부 (Y/N)
    column_comment TEXT,                   -- 원본 컬럼 설명
    llm_comment TEXT,                      -- LLM이 보강한 컬럼 설명
    llm_comment_confidence FLOAT,          -- LLM 보강 설명의 신뢰도
    created_at DATETIME,
    updated_at DATETIME,
    FOREIGN KEY(table_id) REFERENCES db_tables(table_id)
);
```

### 2.3 edges (관계선 정보)

```sql
CREATE TABLE edges (
    edge_id INTEGER NOT NULL PRIMARY KEY,
    project_id INTEGER NOT NULL,          -- 외래키: projects.project_id
    src_type VARCHAR(50) NOT NULL,        -- 소스 타입 (method, table 등)
    src_id INTEGER NOT NULL,              -- 소스 ID
    dst_type VARCHAR(50) NOT NULL,        -- 대상 타입 (method, table 등)
    dst_id INTEGER,                       -- 대상 ID
    edge_kind VARCHAR(50) NOT NULL,       -- 관계 종류 (call, join 등)
    confidence FLOAT,                     -- 신뢰도
    meta TEXT,                           -- 메타 정보 (JSON 형태)
    created_at DATETIME,
    FOREIGN KEY(project_id) REFERENCES projects(project_id)
);
```

## 3. 현재 데이터 현황

### 3.1 테이블 및 컬럼 현황

- **테이블 수**: 15개 (db_tables)
- **컬럼 수**: 168개 (db_columns)
- **Primary Key 정보**: db_pk 테이블에 저장

### 3.2 관계선 현황

- **총 관계선 수**: 275개 (edges)
- **관계 종류**: 현재 "call" 타입만 존재
  - method → method 호출 관계: 275개

### 

## 4. 관계선 생성 현황

### 4.1 쿼리 분석으로부터 생성된 관계선

- **현재 상태**: 주로 Java 메소드 간 호출 관계만 파싱됨
- **SQL 조인 관계**: joins 테이블에 별도 저장 중
- **테이블 간 관계**: 아직 edges 테이블에 반영되지 않음

### 4.2 관계선 메타 정보 예시

```json
{
  "called_name": "getCurrentDate",
  "callee_qualifier_type": "DateUtil",
  "src_method_fqn": "com.example.config.DatabaseConfig.getConnectionString"
}
```

## 5. 추가 분석 영역

### 5.1 SQL 조인 분석

- **joins 테이블**: SQL 쿼리에서 파싱된 조인 조건 저장
- **테이블 간 관계**: 조인 조건을 edges 테이블로 변환

### 5.2 Primary Key / Foreign Key 관계

- **db_pk 테이블**: Primary Key 정보 저장됨
- **FK 관계**: 별도 테이블 또는 edges 테이블에 추가 

### 5.3 데이터 완성도

- **LLM 보강**: 대부분 테이블/컬럼의 llm_comment가 비어있음
- **신뢰도**: 전반적으로 낮은 confidence 값

## 6. 다음 단계 제안

1. **조인 관계 변환**: joins 테이블 데이터를 edges 테이블로 통합
2. **FK 관계 추출**: 테이블 간 참조 관계 분석 및 저장
3. **LLM 보강**: 테이블/컬럼 설명 자동 생성
4. **시각화 준비**: ERD 생성을 위한 관계선 데이터 완성

## 7. 주요 테이블 목록

### 7.1 메타데이터 저장

- projects, files, classes, methods
- sql_units, java_imports

### 7.2 데이터베이스 스키마

- db_tables, db_columns, db_pk, db_views
- joins, required_filters

### 7.3 관계 및 분석

- edges, edge_hints, relatedness
- embeddings, summaries

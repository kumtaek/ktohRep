# Q_20250906_1030_CSV파일존재하지만DB테이블0건문제

## 📋 문제 상황

**발생일**: 2025-09-06  
**문제**: CSV 파일은 존재하지만 메타디비 테이블에 데이터가 0건인 문제

## 🔍 문제 상세

### 1. CSV 파일 존재 확인
- **위치**: `./project/sampleSrc/db_schema/`
- **파일들**:
  - `ALL_TABLES.csv` (1KB)
  - `ALL_TAB_COLUMNS.csv` (5KB)  
  - `PK_INFO.csv` (1KB)
  - `ALL_VIEWS.csv` (1KB)

### 2. 메타디비 테이블 현황 (0건)
| 테이블명 | 예상 데이터 소스 | 실제 레코드 수 | 상태 |
|----------|------------------|----------------|------|
| **db_tables** | ALL_TABLES.csv | 0개 | ❌ |
| **db_columns** | ALL_TAB_COLUMNS.csv | 0개 | ❌ |
| **db_pk** | PK_INFO.csv | 0개 | ❌ |
| **db_views** | ALL_VIEWS.csv | 0개 | ❌ |

### 3. 로그에서 확인된 오류
```
DB 스키마 CSV 파일을 찾을 수 없습니다: ./project/sampleSrc/db_schema
```

## 🤔 문제 분석

### 가능한 원인들:

#### 1. 경로 문제
- **상대경로 vs 절대경로**: CSV 로더가 상대경로를 제대로 해석하지 못함
- **경로 구분자**: Windows vs Unix 경로 구분자 문제
- **작업 디렉토리**: 실행 시점의 작업 디렉토리가 예상과 다름

#### 2. CSV 로딩 로직 문제
- **CsvLoader.load_project_db_schema()** 메서드가 실행되지 않음
- **CSV 파일 검색 로직**에 문제가 있음
- **파일 존재 여부 확인** 로직이 잘못됨

#### 3. 파싱 오류
- **CSV 파일 형식**이 예상과 다름
- **인코딩 문제**: UTF-8 vs 다른 인코딩
- **CSV 구분자** 문제 (쉼표, 세미콜론 등)

#### 4. 데이터베이스 저장 오류
- **트랜잭션 롤백**: 저장 중 오류로 롤백됨
- **제약조건 위반**: 외래키, NOT NULL 등 제약조건 위반
- **데이터 타입 불일치**: CSV 데이터와 DB 스키마 불일치

#### 5. 실행 순서 문제
- **CSV 로딩이 호출되지 않음**: main.py에서 _load_db_schema() 호출 누락
- **비동기 처리 문제**: await 처리 누락
- **예외 처리**: 오류가 발생했지만 로그에 기록되지 않음

## 🔧 확인 필요한 사항들

### 1. 코드 확인
- `main.py`의 `_load_db_schema()` 메서드 호출 여부
- `CsvLoader.load_project_db_schema()` 메서드 실행 여부
- CSV 파일 경로 구성 로직

### 2. 로그 확인
- CSV 로딩 관련 상세 로그
- 오류 메시지 및 스택 트레이스
- 파일 검색 과정 로그

### 3. CSV 파일 내용 확인
- 파일 형식 및 인코딩
- 데이터 구조 및 내용
- 예상 스키마와의 일치 여부

### 4. 실행 환경 확인
- 작업 디렉토리
- 파일 권한
- 경로 설정

## ❓ 질문사항

1. **CSV 로딩이 언제 실행되어야 하나요?** (프로젝트 분석 시작 시? 별도 단계?)

2. **CSV 파일 경로는 어떻게 구성되어야 하나요?** (절대경로? 상대경로?)

3. **CSV 파일 형식은 어떤 구조여야 하나요?** (컬럼명, 데이터 타입 등)

4. **오류 발생 시 어떻게 처리되어야 하나요?** (계속 진행? 중단?)

5. **CSV 로딩 실패가 전체 분석에 영향을 주나요?**

## 🎯 해결 방향

1. **로깅 강화**: CSV 로딩 과정의 상세 로그 추가
2. **경로 검증**: 파일 존재 여부 확인 로직 개선  
3. **오류 처리**: 예외 발생 시 명확한 오류 메시지 제공
4. **테스트**: CSV 파일 로딩 단위 테스트 추가

---

**작성자**: AI Assistant  
**작성일**: 2025-09-06 10:30  
**상태**: 대기 중 (사용자 답변 필요)

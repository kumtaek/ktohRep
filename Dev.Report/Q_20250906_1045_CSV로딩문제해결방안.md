# Q_20250906_1045_CSV로딩문제해결방안

## 📋 문제 상황

**발생일**: 2025-09-06  
**문제**: CSV 파일은 존재하지만 메타디비 테이블에 데이터가 0건인 문제  
**제약사항**: 하드코딩 금지 (동적 분석 원칙 준수)

## 🔍 문제 분석 결과

### 1. CSV 파일 현황
- **위치**: `./project/sampleSrc/db_schema/`
- **파일들**: ALL_TABLES.csv, ALL_TAB_COLUMNS.csv, PK_INFO.csv, ALL_VIEWS.csv
- **상태**: 파일 존재함, 크기 정상

### 2. 메타디비 테이블 현황
- **db_tables**: 0건 (ALL_TABLES.csv에서 로드되어야 함)
- **db_columns**: 0건 (ALL_TAB_COLUMNS.csv에서 로드되어야 함)
- **db_pk**: 0건 (PK_INFO.csv에서 로드되어야 함)
- **db_views**: 0건 (ALL_VIEWS.csv에서 로드되어야 함)

### 3. 로그에서 확인된 오류
```
DB 스키마 CSV 파일을 찾을 수 없습니다: ./project/sampleSrc/db_schema
```

## 🤔 가능한 원인 분석

### 1. 경로 문제 (90% 확률)
- **상대경로 해석 문제**: `CsvLoader`가 `./project/sampleSrc/db_schema` 경로를 제대로 해석하지 못함
- **작업 디렉토리 불일치**: 실행 시점의 작업 디렉토리가 예상과 다름
- **경로 구분자 문제**: Windows vs Unix 경로 구분자

### 2. CSV 로딩 로직 미실행 (80% 확률)
- **메서드 호출 누락**: `main.py`의 `analyze_project()`에서 `_load_db_schema()` 호출이 누락됨
- **예외 발생**: 호출되지만 예외 발생으로 실패
- **비동기 처리 문제**: `await` 처리 누락

### 3. CSV 파일 형식 문제 (60% 확률)
- **컬럼명 불일치**: CSV 파일의 컬럼명이 `CsvLoader`가 예상하는 것과 다름
- **인코딩 문제**: UTF-8 vs 다른 인코딩
- **CSV 구분자 문제**: 쉼표, 세미콜론 등

## 🎯 제안하는 해결 방안

### 1. 로깅 강화 (우선순위 1)
**목적**: 정확한 원인 파악
**방법**: 
- `CsvLoader`에 상세 로그 추가
- 파일 경로 구성 과정 로깅
- 파일 존재 여부 확인 로깅
- CSV 파싱 과정 로깅
- DB 저장 과정 로깅

### 2. 경로 동적 구성 개선 (우선순위 2)
**목적**: 상대경로 문제 해결
**방법**:
- 실행 시점의 작업 디렉토리 고려
- 프로젝트 루트 경로 동적 계산
- 경로 정규화 및 검증 로직 추가

### 3. 예외 처리 개선 (우선순위 3)
**목적**: 오류 발생 시 명확한 정보 제공
**방법**:
- CSV 로딩 실패 시 명확한 오류 메시지 출력
- 부분 실패 시에도 성공한 부분은 저장
- 스택 트레이스 포함한 상세 오류 로깅

### 4. CSV 파일 검증 로직 추가 (우선순위 4)
**목적**: 파일 형식 문제 사전 감지
**방법**:
- CSV 파일 존재 여부 확인
- 파일 크기 및 접근 권한 확인
- CSV 헤더 및 형식 검증
- 인코딩 자동 감지

## ❓ 구체적 질문사항

### 1. 로깅 관련
- **Q1**: `CsvLoader`에 어떤 레벨의 로깅을 추가해야 하나요? (DEBUG, INFO, WARNING, ERROR)
- **Q2**: 로깅할 구체적인 정보는 무엇인가요? (파일 경로, 파싱 결과, 저장 결과 등)

### 2. 경로 처리 관련
- **Q3**: 프로젝트 루트 경로를 어떻게 동적으로 계산해야 하나요?
- **Q4**: 상대경로를 절대경로로 변환하는 로직이 필요한가요?
- **Q5**: Windows와 Linux 환경 모두에서 동작하도록 해야 하나요?

### 3. 예외 처리 관련
- **Q6**: CSV 로딩 실패 시 전체 분석을 중단해야 하나요, 아니면 계속 진행해야 하나요?
- **Q7**: 부분적으로 성공한 CSV 파일들은 어떻게 처리해야 하나요?
- **Q8**: 사용자에게 어떤 형태로 오류를 알려야 하나요?

### 4. CSV 파일 검증 관련
- **Q9**: CSV 파일의 필수 컬럼은 무엇인가요?
- **Q10**: CSV 파일 형식이 잘못된 경우 어떻게 처리해야 하나요?
- **Q11**: 인코딩 문제는 어떻게 해결해야 하나요?

### 5. 성능 및 확장성 관련
- **Q12**: 대용량 CSV 파일 처리를 고려해야 하나요?
- **Q13**: CSV 파일이 여러 개일 때 병렬 처리가 필요한가요?
- **Q14**: 메모리 사용량 최적화가 필요한가요?

## 🎯 구현 우선순위

### Phase 1: 문제 진단 (1-2시간)
1. 로깅 강화로 정확한 원인 파악
2. 현재 실행 흐름 추적

### Phase 2: 핵심 문제 해결 (2-4시간)
1. 경로 동적 구성 개선
2. 예외 처리 개선

### Phase 3: 안정성 강화 (1-2시간)
1. CSV 파일 검증 로직 추가
2. 오류 복구 메커니즘 구현

## 🔧 제약사항

- **하드코딩 금지**: 경로, 파일명, 프로젝트명 등을 하드코딩하지 않음
- **동적 분석**: 다양한 프로젝트 구조에 대응 가능
- **상대경로 사용**: 절대경로 의존성 제거
- **오프라인 환경**: 인터넷 연결 없이 동작

## 📋 기대 결과

1. **CSV 파일이 정상적으로 로드됨**
2. **db_tables, db_columns, db_pk, db_views 테이블에 데이터 저장됨**
3. **오류 발생 시 명확한 오류 메시지 제공**
4. **다양한 프로젝트 구조에서 동작**

---

**작성자**: AI Assistant  
**작성일**: 2025-09-06 10:45  
**상태**: 대기 중 (사용자 답변 필요)

연관성 스코어를 개발 완료했어.  시각화를 해야 하는데 지금까지 시각화는 왼쪽에서 오른쪽으로 길게 늘어져서 보기가 좋지 않았어.  지금까지 개발된 시각화 리포트에 연관도가 높은 것끼리 인접하게 그려서 보기좋게 개선해줘.  일단 개발전에 설계부터 해봐.  상세 설계와 이해를 돕기 위해 소스스니펫까지 제공해줘.
복사
설계 개요
현재 시각화는 dagre 레이아웃을 사용하여 왼쪽→오른쪽 방향으로만 배치되어 연관성이 높은 노드들이 멀리 떨어져 보입니다.
이를 개선하기 위해 다음 설계를 제안합니다.

연관성 데이터 활용

phase1에서 계산된 Relatedness 테이블의 점수를 시각화에서 직접 사용합니다.

VizDB에 연관성 조회 기능을 추가하여 노드 간 연관성 가중치를 불러옵니다.

클러스터 기반 배치

AdvancedClusterer를 확장하여 관련성 점수를 기반으로 Louvain 같은 커뮤니티 탐지 알고리즘을 실행해 cluster_id를 부여합니다.

각 클러스터별로 대표 노드를 생성하고, 클러스터 간 관계를 집계합니다.

물리 기반 레이아웃 적용

cytoscape-fcose 플러그인으로 물리 기반(fcose) 레이아웃을 적용하여 연관성이 높은 노드가 가까이 배치되도록 합니다.

기존 dagre 옵션을 기본으로 유지하면서 토글 또는 기본값을 fcose로 바꿉니다.

시각적 개선

연관성 점수를 Edge의 weight로 전달하여 fcose 레이아웃이 간선 길이를 점수에 따라 조정하도록 합니다.

클러스터별 색상·범례를 자동 생성하여 가독성을 높입니다.

예시 코드 스니펫
# visualize/data_access.py
def fetch_relatedness(self, project_id: int, min_score: float = 0.0):
    session = self.session()
    try:
        query = session.query(Relatedness).filter(Relatedness.project_id == project_id)
        if min_score > 0:
            query = query.filter(Relatedness.score >= min_score)
        return query.all()
    finally:
        session.close()
# visualize/builders/cluster_graph.py (새 파일)
import networkx as nx
from networkx.algorithms.community import louvain_communities

def build_cluster_graph_json(...):
    dep_graph = build_dependency_graph_json(...)
    G = nx.Graph()
    for e in dep_graph["edges"]:
        G.add_edge(e["source"], e["target"], weight=e.get("confidence", 0.5))

    communities = louvain_communities(G, weight="weight")
    node_cluster = {n: idx for idx, comm in enumerate(communities) for n in comm}
    for n in dep_graph["nodes"]:
        n["cluster_id"] = node_cluster.get(n["id"], 0)
    ...
<!-- visualize/templates/cyto_base.html -->
<script src="./static/vendor/cytoscape-fcose/cytoscape-fcose.js"></script>
<script>
  const usePhysics = true;
  const layoutOptions = usePhysics
    ? { name: 'fcose', quality: 'proof', animate: true }
    : { name: 'dagre', rankDir: 'LR', nodeSep: 40, rankSep: 80 };
  cy.layout(layoutOptions).run();
</script>
개선 작업
연관성 테이블 연계

VizDB에 fetch_relatedness 메서드를 추가하고, 의존성 그래프 빌더에서 연관성 데이터를 함께 로드합니다.

제안된 작업
Load relatedness edges for visualization
작업 보기
Louvain 기반 클러스터링

AdvancedClusterer를 확장하거나 별도 모듈을 만들어 관련성 가중치 기반 Louvain 클러스터링을 실행합니다.

제안된 작업
Cluster nodes using relatedness weights
작업 보기
fcose 레이아웃 및 토글 제공

cytoscape-fcose 플러그인을 추가하고 기본 레이아웃을 fcose로 변경, 필요 시 버튼으로 dagre ↔ fcose 토글을 제공합니다.

제안된 작업
Switch visualization layout to fcose
작업 보기
클러스터 시각적 강조

노드 cluster_id 기반 색상 테마와 범례를 동적으로 생성합니다.

제안된 작업
Color and legend for clusters
작업 보기
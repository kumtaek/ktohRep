<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.OrderMapper">

  <resultMap id="orderMap" type="com.example.model.Order">
    <id property="id" column="id"/>
    <result property="customerId" column="customer_id"/>
    <result property="status" column="status"/>
    <result property="createdAt" column="created_at"/>
  </resultMap>

  <select id="listByFilter" parameterType="com.example.model.OrderFilter" resultMap="orderMap">
    SELECT o.id, o.customer_id, o.status, o.created_at
    FROM T_ORDER o
    <where>
      <if test="status != null"> AND o.status = #{status} </if>
      <if test="from != null"> AND o.created_at &gt;= #{from} </if>
      <if test="to != null"> AND o.created_at &lt;= #{to} </if>
      <if test="statuses != null and statuses.size() &gt; 0">
        AND o.status IN
        <foreach item="s" collection="statuses" open="(" separator="," close=")">
          #{s}
        </foreach>
      </if>
    </where>
    ORDER BY o.id DESC
  </select>

  <select id="findById" parameterType="long" resultMap="orderMap">
    SELECT o.id, o.customer_id, o.status, o.created_at
    FROM T_ORDER o
    WHERE o.id = #{id}
  </select>

  <insert id="insertOrder" parameterType="com.example.model.Order">
    INSERT INTO T_ORDER(id, customer_id, status, created_at)
    VALUES (#{id}, #{customerId}, #{status}, #{createdAt})
  </insert>

  <update id="updateStatus">
    UPDATE T_ORDER SET status = #{param2} WHERE id = #{param1}
  </update>

</mapper>

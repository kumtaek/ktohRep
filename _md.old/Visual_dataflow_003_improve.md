# Visual Dataflow v2 개선 및 검토 사항

본 문서는 `Visual_dataflow_001_req.md` (요구사항) 및 `Visual_dataflow_002_plan.md` (설계/구현 계획) 문서를 검토한 결과입니다. 전반적으로 두 문서 모두 매우 상세하고 명확하게 작성되어 있으며, 특히 `Visual_dataflow_002_plan.md`는 Mermaid의 한계를 명확히 인지하고 현실적인 대안을 제시하는 등 높은 수준의 설계를 보여줍니다.

아래는 발견된 문제점 및 개선 제안 사항입니다.

---

## 1. 요구사항 명확화 및 계획 보완

### 1.1. JSP SQL 파싱 - Tree-sitter 통합 여부 명확화
*   **문제점**: `Visual_dataflow_001_req.md`의 "SQL 단위 추출" 섹션에서 JSP SQL 추출 방식에 "Tree-sitter, 폴백 정규식"을 언급하고 있습니다. 하지만 `Visual_dataflow_002_plan.md`에서는 Tree-sitter의 실제 통합 여부나 구체적인 활용 방안에 대한 설명이 부족합니다.
*   **개선 제안**:
    *   현재 Tree-sitter가 JSP 파싱에 실제로 사용되고 있는지, 아니면 향후 계획인지 명확히 해주세요.
    *   만약 현재 정규식 기반으로만 동작한다면, 요구사항 문서에서 Tree-sitter 언급을 제거하거나, 향후 확장 계획으로 명시하여 혼동을 줄이는 것이 좋습니다.
    *   `Visual_dataflow_002_plan.md`의 "메타 생성 수정 가능성" 섹션에서 JSP 파싱 고도화 방안으로 Tree-sitter 통합을 구체적으로 언급할 수 있습니다.
*   **개발자 상세 설명**: Tree-sitter는 정규식보다 훨씬 견고하고 정확한 구문 분석을 제공하여 복잡한 JSP 스크립틀릿 내 동적 SQL을 안정적으로 추출하는 데 필수적입니다. 현재 정규식 기반이라면, 특정 패턴에서 오탐 또는 미탐이 발생할 수 있습니다. 향후 Tree-sitter 통합을 우선순위에 두어 파싱 정확도를 높이는 것을 권장합니다.

### 1.2. 미해결 호출(`call_unresolved`) 후처리 전략 상세화
*   **문제점**: `Visual_dataflow_001_req.md`는 "미해결 호출은 후처리로 해석 시도"한다고 명시하지만, `Visual_dataflow_002_plan.md`에서는 이 '후처리'가 어떤 방식으로 이루어지는지에 대한 구체적인 설명이 없습니다.
*   **개선 제안**: `Visual_dataflow_002_plan.md`의 "호출 연결" 또는 "메타 보강 기능 시나리오" 섹션에서 `call_unresolved` 엣지를 해결하기 위한 간단한 휴리스틱(예: 메서드 이름 매칭, 인자 수 기반 추론)이나 별도의 해소 로직에 대해 간략하게라도 설명해주세요.
*   **개발자 상세 설명**: 미해결 호출은 그래프의 완성도를 저해하고 분석의 신뢰도를 낮출 수 있습니다. 간단한 휴리스틱이라도 적용하여 미해결 호출의 수를 줄이는 것은 그래프의 유용성을 크게 향상시킬 것입니다. 예를 들어, `IntegratedService.java`에서 `integratedMapper`의 메서드를 호출하는 경우, `IntegratedMapper.java`에 정의된 메서드와 매칭을 시도하는 등의 로직을 고려할 수 있습니다.

---

## 2. Mermaid 시각화 및 스타일 관련 개선

### 2.1. Hotspot 및 취약점 스타일 중첩 시 가독성 확보
*   **문제점**: `Visual_dataflow_002_plan.md`에서 Hotspot과 취약점 스타일이 동일 노드에 적용될 때 가독성 충돌 가능성을 인지하고, "우선순위 규칙(취약점 테두리, Hotspot 내부 색)"을 제안한 것은 매우 좋습니다.
*   **개선 제안**: 이 우선순위 규칙이 `visualize/exporters/mermaid_exporter.py`에서 명확하게 구현되고, 생성되는 Markdown 문서의 범례(Legend)에 이 스타일 적용 규칙이 명시되도록 해주세요.
*   **개발자 상세 설명**: Mermaid의 `classDef`와 `class` 지시어의 적용 순서 및 CSS 속성 우선순위를 고려하여, 취약점의 `stroke` (테두리)가 Hotspot의 `fill` (배경색) 위에 항상 명확하게 보이도록 테스트해야 합니다. 예를 들어, `stroke-width`를 충분히 크게 설정하거나, `stroke-dasharray`를 활용하여 시각적 구분을 강화할 수 있습니다.

### 2.2. 대규모 그래프 Mermaid Export 전략 강화
*   **문제점**: 두 문서 모두 대규모 그래프가 Mermaid 렌더링 문제를 일으킬 수 있음을 언급하며 `--export-strategy minimal` 또는 `--max-nodes`/`--depth` 옵션을 제안합니다.
*   **개선 제안**:
    *   `improve.md`에서 이 옵션들의 중요성을 다시 한번 강조하고, `mermaid_exporter.py`에서 기본 `max_nodes` 제한을 설정하여 너무 큰 다이어그램이 기본적으로 생성되지 않도록 하는 것을 고려해볼 수 있습니다.
    *   또는, 생성된 Mermaid 코드의 라인 수가 특정 임계값을 초과할 경우, 사용자에게 `--max-nodes` 또는 `--depth` 옵션을 사용하도록 권장하는 경고 메시지를 Markdown 출력에 포함하는 것도 좋은 방법입니다.
*   **개발자 상세 설명**: GitHub나 VS Code의 Mermaid 렌더러는 대규모 그래프에 취약합니다. 사용자가 기본 옵션으로 큰 프로젝트를 시각화할 때 렌더링 실패를 경험하지 않도록, 익스포터 레벨에서 적절한 기본 제한을 두거나 명확한 가이드를 제공하는 것이 사용자 경험에 중요합니다.

---

## 3. 데이터 및 스키마 일관성/확장성

### 3.1. `IntegratedMapper.xml` 참조 테이블과 `DB_SCHEMA` 일관성 설명
*   **문제점**: 이전 검토에서 `IntegratedMapper.xml`이 `DB_SCHEMA`에 정의되지 않은 수많은 테이블(예: `SALES_TRANSACTIONS`, `PROMOTIONS`, `REVIEWS` 등)을 참조하고 있음을 확인했습니다. 이는 분석기의 견고성 테스트를 위한 의도적인 설계로 보이지만, 문서에는 명확히 설명되어 있지 않습니다.
*   **개선 제안**: `Visual_dataflow_001_req.md` 또는 `Visual_dataflow_002_plan.md`에 `IntegratedMapper.xml`이 `DB_SCHEMA`에 없는 테이블을 다수 포함하고 있으며, 이는 분석기가 불완전한 스키마 정보에 대해 어떻게 동작하는지 테스트하기 위함이라는 설명을 추가해주세요.
*   **개발자 상세 설명**: 분석기는 `DB_SCHEMA`에 없는 테이블에 대해서도 `use_table` 엣지를 생성할 수 있어야 합니다. 이러한 '미확인' 테이블에 대한 처리 방식(예: 낮은 신뢰도 부여, 특정 그룹으로 분류)이 명확히 정의되고 테스트되어야 합니다. 현재 설계가 의도한 바라면, 이 점을 명확히 문서화하여 오해를 방지하고 테스트 목적을 분명히 하는 것이 좋습니다.

### 3.2. 데이터 라인리지(Lineage) 세분화의 한계 및 향후 확장 계획
*   **문제점**: `Visual_dataflow_001_req.md`의 "실무 팁(데이터 흐름 강조)" 섹션에서 "변수/필드 단위의 정밀 데이터 라인리지는 제한적"이라고 명시한 것은 매우 중요하고 현실적인 한계입니다. `Visual_dataflow_002_plan.md`의 "메타 생성 수정 가능성"에서도 이 점을 언급합니다.
*   **개선 제안**: `improve.md`에 이 한계를 다시 한번 강조하고, 향후 이 기능을 확장할 경우 어떤 추가적인 파서/메타데이터 작업이 필요한지 간략하게 설명하여 장기적인 로드맵을 제시하는 것이 좋습니다.
*   **개발자 상세 설명**: 변수/필드 단위의 데이터 라인리지는 AST(Abstract Syntax Tree) 기반의 정밀한 코드 분석과 데이터 흐름 추적을 요구합니다. 이는 현재의 파서 구조를 넘어선 상당한 개발 노력이 필요하며, 파라미터 바인딩, HTTP 요청 파라미터와 SQL 매핑 등 복잡한 시나리오를 처리하기 위한 별도의 모듈 설계가 필요할 것입니다. 현재는 호출 그래프와 SQL-테이블 매핑 수준으로 제공하는 것이 합리적입니다.

---

## 4. 문서화 및 CLI 사용 일관성

### 4.1. CLI 명령 사용법 일관성 유지
*   **문제점**: `Visual_dataflow_001_req.md`의 "빠른 시작(명령 예시)" 섹션에서 `python -m visualize.cli graph`와 같이 `visualize.cli`를 명시적으로 사용하는 반면, `Visual_dataflow_002_plan.md`의 "ERD 시나리오"에서는 `python -m visualize erd`와 같이 `cli` 모듈을 생략하고 있습니다.
*   **개선 제안**: 모든 문서와 예시에서 `python -m visualize.cli <subcommand>` 형식을 일관되게 사용하여 명확성을 높여주세요.
*   **개발자 상세 설명**: `python -m visualize erd`도 동작할 수 있지만, `visualize/cli.py`가 실제 CLI 진입점임을 명시적으로 보여주는 `python -m visualize.cli erd` 형식이 더 명확하고 문서의 일관성을 유지하는 데 도움이 됩니다.

---

## 결론

`Visual_dataflow_001_req.md`와 `Visual_dataflow_002_plan.md`는 매우 잘 작성된 문서입니다. 위에서 제시된 개선 사항들은 주로 명확성, 일관성, 그리고 향후 확장성을 고려한 보완적인 제안들입니다. 이 제안들을 반영하여 문서를 업데이트하면, 개발자들이 기능을 이해하고 구현하며 테스트하는 데 더욱 큰 도움이 될 것입니다.

특히, Mermaid의 시각적 한계를 명확히 인지하고 색상/라벨/외곽선 등으로 보완하려는 설계는 매우 현실적이고 효과적인 접근 방식입니다. 이 설계를 바탕으로 구현이 완료되면, Markdown 기반의 데이터 흐름 시각화는 프로젝트의 문서화 및 코드 리뷰 프로세스에 큰 가치를 더할 것입니다.

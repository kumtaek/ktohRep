# 메타 데이터베이스 명세

`SourceAnalyzer`는 분석된 소스 코드 및 데이터베이스 관련 메타데이터를 SQLite (개발) 또는 Oracle (운영) 데이터베이스에 저장합니다. 이 문서는 데이터베이스에 저장되는 주요 엔티티(테이블)와 그 속성(컬럼), 그리고 엔티티 간의 관계를 설명합니다.

## 1. 프로젝트 (Project)

프로젝트의 기본 정보를 저장합니다.

-   **`project_id`**: (Integer, Primary Key) 프로젝트 고유 ID
-   **`root_path`**: (Text, Not Null) 프로젝트의 루트 경로
-   **`name`**: (String(255)) 프로젝트 이름
-   **`created_at`**: (DateTime) 프로젝트 생성 시간
-   **`updated_at`**: (DateTime) 프로젝트 최종 업데이트 시간

## 2. 파일 (File)

프로젝트 내의 개별 파일 정보를 저장합니다.

-   **`file_id`**: (Integer, Primary Key) 파일 고유 ID
-   **`project_id`**: (Integer, Foreign Key to `projects.project_id`, Not Null) 파일이 속한 프로젝트 ID
-   **`path`**: (Text, Not Null) 파일의 상대 경로
-   **`language`**: (String(50)) 파일의 프로그래밍 언어 (예: `java`, `jsp`, `xml`)
-   **`hash`**: (String(64)) 파일 내용의 SHA-256 해시 (변경 감지용)
-   **`loc`**: (Integer) 코드 라인 수 (Lines of Code)
-   **`mtime`**: (DateTime) 파일 최종 수정 시간
-   **`llm_summary`**: (Text) LLM이 생성한 파일 요약
-   **`llm_summary_confidence`**: (Float) LLM 요약의 신뢰도

## 3. 클래스 (Class)

Java 파일 내의 클래스 정보를 저장합니다.

-   **`class_id`**: (Integer, Primary Key) 클래스 고유 ID
-   **`file_id`**: (Integer, Foreign Key to `files.file_id`, Not Null) 클래스가 정의된 파일 ID
-   **`fqn`**: (Text) Fully Qualified Name (정규화된 이름, 예: `com.example.MyClass`)
-   **`name`**: (String(255), Not Null) 클래스 이름
-   **`start_line`**: (Integer) 클래스 정의 시작 라인
-   **`end_line`**: (Integer) 클래스 정의 종료 라인
-   **`modifiers`**: (Text) 접근 제어자 등 (JSON 배열)
-   **`annotations`**: (Text) 어노테이션 (JSON 배열)
-   **`llm_summary`**: (Text) LLM이 생성한 클래스 요약
-   **`llm_summary_confidence`**: (Float) LLM 요약의 신뢰도

## 4. 메서드 (Method)

클래스 내의 메서드 정보를 저장합니다.

-   **`method_id`**: (Integer, Primary Key) 메서드 고유 ID
-   **`class_id`**: (Integer, Foreign Key to `classes.class_id`, Not Null) 메서드가 속한 클래스 ID
-   **`name`**: (String(255), Not Null) 메서드 이름
-   **`signature`**: (Text) 메서드 시그니처 (예: `myMethod(String arg1, int arg2)`)
-   **`return_type`**: (String(255)) 반환 타입
-   **`start_line`**: (Integer) 메서드 정의 시작 라인
-   **`end_line`**: (Integer) 메서드 정의 종료 라인
-   **`annotations`**: (Text) 어노테이션 (JSON 배열)
-   **`parameters`**: (Text) 파라미터 목록 (JSON 또는 문자열)
-   **`modifiers`**: (Text) 접근 제어자 등 (JSON 배열)
-   **`llm_summary`**: (Text) LLM이 생성한 메서드 요약
-   **`llm_summary_confidence`**: (Float) LLM 요약의 신뢰도

## 5. SQL 단위 (SqlUnit)

JSP/MyBatis 파일 내에서 발견된 SQL 구문 단위를 저장합니다.

-   **`sql_id`**: (Integer, Primary Key) SQL 단위 고유 ID
-   **`file_id`**: (Integer, Foreign Key to `files.file_id`, Not Null) SQL이 포함된 파일 ID
-   **`origin`**: (String(50)) SQL의 출처 (예: `mybatis`, `jsp`)
-   **`mapper_ns`**: (String(255)) MyBatis 네임스페이스 (MyBatis SQL인 경우)
-   **`stmt_id`**: (String(255)) Statement ID (MyBatis SQL인 경우)
-   **`start_line`**: (Integer) SQL 구문 시작 라인
-   **`end_line`**: (Integer) SQL 구문 종료 라인
-   **`stmt_kind`**: (String(50)) SQL 구문 종류 (예: `select`, `insert`, `update`, `delete`, `procedure`, `function`)
-   **`normalized_fingerprint`**: (Text) SQL의 구조적 지문 (원본 SQL이 아닌 정규화된 형태)
-   **`llm_summary`**: (Text) LLM이 생성한 SQL 단위 요약
-   **`llm_summary_confidence`**: (Float) LLM 요약의 신뢰도

## 6. DB 테이블 (DbTable)

데이터베이스 테이블 메타데이터를 저장합니다.

-   **`table_id`**: (Integer, Primary Key) 테이블 고유 ID
-   **`owner`**: (String(128)) 테이블 소유자/스키마
-   **`table_name`**: (String(128), Not Null) 테이블 이름
-   **`status`**: (String(50)) 테이블 상태 (예: `ACTIVE`, `INFERRED`)
-   **`table_comment`**: (Text) 원본 테이블 설명
-   **`llm_comment`**: (Text) LLM이 보강한 테이블 설명
-   **`llm_comment_confidence`**: (Float) LLM 보강 설명의 신뢰도

## 7. DB 컬럼 (DbColumn)

데이터베이스 테이블의 컬럼 메타데이터를 저장합니다.

-   **`column_id`**: (Integer, Primary Key) 컬럼 고유 ID
-   **`table_id`**: (Integer, Foreign Key to `db_tables.table_id`, Not Null) 컬럼이 속한 테이블 ID
-   **`column_name`**: (String(128), Not Null) 컬럼 이름
-   **`data_type`**: (String(128)) 데이터 타입
-   **`nullable`**: (String(1)) Null 허용 여부 (Y/N)
-   **`column_comment`**: (Text) 원본 컬럼 설명
-   **`llm_comment`**: (Text) LLM이 보강한 컬럼 설명
-   **`llm_comment_confidence`**: (Float) LLM 보강 설명의 신뢰도

## 8. DB PK (DbPk)

데이터베이스 테이블의 Primary Key 정보를 저장합니다.

-   **`table_id`**: (Integer, Foreign Key to `db_tables.table_id`, Primary Key) PK가 속한 테이블 ID
-   **`column_name`**: (String(128), Primary Key) PK 컬럼 이름
-   **`pk_pos`**: (Integer) 복합 키 내에서의 위치

## 9. DB 뷰 (DbView)

데이터베이스 뷰 메타데이터를 저장합니다.

-   **`view_id`**: (Integer, Primary Key) 뷰 고유 ID
-   **`owner`**: (String(128)) 뷰 소유자/스키마
-   **`view_name`**: (String(128), Not Null) 뷰 이름
-   **`text`**: (CLOB) 뷰 정의 SQL

## 10. 엣지 (Edge)

코드 엔티티 간의 의존성 관계를 저장합니다.

-   **`edge_id`**: (Integer, Primary Key) 엣지 고유 ID
-   **`project_id`**: (Integer, Foreign Key to `projects.project_id`, Not Null) 엣지가 속한 프로젝트 ID
-   **`src_type`**: (String(50), Not Null) 소스 엔티티 타입 (예: `method`, `class`, `sql_unit`)
-   **`src_id`**: (Integer, Not Null) 소스 엔티티 ID
-   **`dst_type`**: (String(50), Not Null) 대상 엔티티 타입
-   **`dst_id`**: (Integer, Nullable) 대상 엔티티 ID (미해결된 엣지의 경우 NULL 가능)
-   **`edge_kind`**: (String(50), Not Null) 엣지 종류 (예: `call`, `use_table`, `use_column`, `extends`, `implements`)
-   **`confidence`**: (Float) 엣지 추론의 신뢰도 (0.0 ~ 1.0)
-   **`meta`**: (Text) 힌트 등 JSON 메타데이터 (예: `called_name`)
-   **`created_at`**: (DateTime) 엣지 생성 시간

## 11. 조인 (Join)

SQL 단위 내에서 발견된 조인 조건을 저장합니다.

-   **`join_id`**: (Integer, Primary Key) 조인 고유 ID
-   **`sql_id`**: (Integer, Foreign Key to `sql_units.sql_id`, Not Null) 조인이 속한 SQL 단위 ID
-   **`l_table`**: (String(128)) 왼쪽 테이블 이름
-   **`l_col`**: (String(128)) 왼쪽 컬럼 이름
-   **`op`**: (String(10)) 조인 연산자 (예: `=`, `!=`)
-   **`r_table`**: (String(128)) 오른쪽 테이블 이름
-   **`r_col`**: (String(128)) 오른쪽 컬럼 이름
-   **`inferred_pkfk`**: (Integer) PK-FK 관계 추론 여부 (1: 추론됨, 0: 추론 안됨)
-   **`confidence`**: (Float) 조인 추론의 신뢰도

## 12. 필수 필터 (RequiredFilter)

SQL 단위 내에서 발견된 필수 필터 조건을 저장합니다.

-   **`filter_id`**: (Integer, Primary Key) 필터 고유 ID
-   **`sql_id`**: (Integer, Foreign Key to `sql_units.sql_id`, Not Null) 필터가 속한 SQL 단위 ID
-   **`table_name`**: (String(128)) 필터가 적용되는 테이블 이름
-   **`column_name`**: (String(128)) 필터가 적용되는 컬럼 이름
-   **`op`**: (String(10)) 필터 연산자 (예: `=`, `!=`, `LIKE`)
-   **`value_repr`**: (String(255)) 필터 값의 표현 (예: `'N'`, `:param`)
-   **`always_applied`**: (Integer) 항상 적용되는 필터인지 여부 (1: 항상 적용, 0: 아님)
-   **`confidence`**: (Float) 필터 추론의 신뢰도

## 13. 요약 (Summary)

LLM이 생성한 다양한 요약 정보를 저장합니다.

-   **`summary_id`**: (Integer, Primary Key) 요약 고유 ID
-   **`target_type`**: (String(50), Not Null) 요약 대상 타입 (예: `method`, `class`, `sql_unit`, `file`)
-   **`target_id`**: (Integer, Not Null) 요약 대상 ID
-   **`summary_type`**: (String(50), Not Null) 요약 종류 (예: `logic`, `vuln`, `perf`, `db_comment_suggestion`)
-   **`lang`**: (String(10)) 요약 언어 (예: `ko`, `en`)
-   **`content`**: (Text) 요약 내용
-   **`confidence`**: (Float) 요약의 신뢰도
-   **`created_at`**: (DateTime) 요약 생성 시간

## 14. 보강 로그 (EnrichmentLog)

LLM 기반 보강 작업에 대한 로그를 저장합니다.

-   **`enrich_id`**: (Integer, Primary Key) 보강 로그 고유 ID
-   **`target_type`**: (String(50), Not Null) 보강 대상 타입
-   **`target_id`**: (Integer, Not Null) 보강 대상 ID
-   **`pre_conf`**: (Float) LLM 보강 전 신뢰도
-   **`post_conf`**: (Float) LLM 보강 후 신뢰도
-   **`model`**: (String(100)) 사용된 LLM 모델
-   **`prompt_id`**: (String(100)) 사용된 프롬프트 템플릿 ID
-   **`params`**: (Text) 사용된 파라미터 (JSON 문자열)
-   **`created_at`**: (DateTime) 로그 생성 시간

## 15. 청크 (Chunk)

임베딩을 위한 텍스트 청크 정보를 저장합니다.

-   **`chunk_id`**: (Integer, Primary Key) 청크 고유 ID
-   **`target_type`**: (String(50), Not Null) 청크 대상 타입
-   **`target_id`**: (Integer, Not Null) 청크 대상 ID
-   **`content`**: (Text) 청크된 내용
-   **`token_count`**: (Integer) 토큰 수
-   **`hash`**: (String(64)) 내용 해시
-   **`created_at`**: (DateTime) 청크 생성 시간

## 16. 임베딩 (Embedding)

생성된 임베딩 벡터 정보를 저장합니다.

-   **`chunk_id`**: (Integer, Foreign Key to `chunks.chunk_id`, Primary Key) 임베딩이 속한 청크 ID
-   **`model`**: (String(100), Not Null) 임베딩 모델 이름
-   **`dim`**: (Integer) 벡터 차원
-   **`faiss_vector_id`**: (Integer) FAISS 인덱스 내 ID
-   **`created_at`**: (DateTime) 임베딩 생성 시간

## 17. Java 임포트 (JavaImport)

Java 파일 내의 임포트 선언을 저장합니다.

-   **`import_id`**: (Integer, Primary Key) 임포트 고유 ID
-   **`file_id`**: (Integer, Foreign Key to `files.file_id`, Not Null) 임포트가 포함된 파일 ID
-   **`class_fqn`**: (Text) 임포트된 클래스의 FQN
-   **`static`**: (Integer) static 임포트 여부 (1: static, 0: 아님)

## 18. 엣지 힌트 (EdgeHint)

관계 해소 단계에서 사용되는 엣지 힌트를 저장합니다.

-   **`hint_id`**: (Integer, Primary Key) 힌트 고유 ID
-   **`project_id`**: (Integer, Foreign Key to `projects.project_id`, Not Null) 힌트가 속한 프로젝트 ID
-   **`src_type`**: (String(50), Not Null) 소스 엔티티 타입
-   **`src_id`**: (Integer, Not Null) 소스 엔티티 ID
-   **`hint_type`**: (String(50), Not Null) 힌트 종류 (예: `method_call`, `jsp_include`)
-   **`hint`**: (Text, Not Null) 힌트 내용 (JSON 형식)
-   **`confidence`**: (Float) 힌트의 신뢰도
-   **`created_at`**: (DateTime) 힌트 생성 시간

## 19. 연관성 (Relatedness)

엔티티 간의 연관성 점수를 저장합니다.

-   **`relatedness_id`**: (Integer, Primary Key) 연관성 고유 ID
-   **`project_id`**: (Integer, Foreign Key to `projects.project_id`, Not Null) 연관성이 속한 프로젝트 ID
-   **`node1_type`**: (String(50), Not Null) 첫 번째 노드 타입 (예: `file`, `class`, `method`, `sql_unit`, `table`)
-   **`node1_id`**: (Integer, Not Null) 첫 번째 노드 ID
-   **`node2_type`**: (String(50), Not Null) 두 번째 노드 타입
-   **`node2_id`**: (Integer, Not Null) 두 번째 노드 ID
-   **`score`**: (Float, Not Null) 연관성 점수 (0.0 ~ 1.0)
-   **`reason`**: (String(100), Not Null) 연관성 추론 이유 (예: `edge_fk`, `directory_proximity`)
-   **`created_at`**: (DateTime) 연관성 생성 시간

## 20. 취약점 수정 (VulnerabilityFix)

발견된 취약점 및 수정 정보를 저장합니다.

-   **`fix_id`**: (Integer, Primary Key) 수정 고유 ID
-   **`target_type`**: (String(50), Not Null) 취약점 대상 타입
-   **`target_id`**: (Integer, Not Null) 취약점 대상 ID
-   **`vulnerability_type`**: (String(100)) 취약점 종류 (예: `sql_injection`, `xss`)
-   **`severity`**: (String(20)) 심각도 (예: `critical`, `high`, `medium`, `low`)
-   **`owasp_category`**: (String(10)) OWASP 카테고리 (예: `A01`, `A02`)
-   **`cwe_id`**: (String(20)) CWE ID (예: `CWE-89`, `CWE-79`)
-   **`reference_urls`**: (Text) 참조 URL (JSON 배열)
-   **`description`**: (Text) 취약점 설명
-   **`fix_description`**: (Text) 수정 방안 설명
-   **`original_code`**: (Text) 취약한 코드 스니펫
-   **`fixed_code`**: (Text) 수정된 코드 스니펫
-   **`start_line`**: (Integer) 취약점 시작 라인
-   **`end_line`**: (Integer) 취약점 종료 라인
-   **`confidence`**: (Float) 취약점 탐지 신뢰도
-   **`created_at`**: (DateTime) 기록 생성 시간

## 21. 코드 메트릭 (CodeMetric)

코드 품질 메트릭을 저장합니다.

-   **`metric_id`**: (Integer, Primary Key) 메트릭 고유 ID
-   **`target_type`**: (String(50), Not Null) 메트릭 대상 타입 (예: `file`, `class`, `method`)
-   **`target_id`**: (Integer, Not Null) 메트릭 대상 ID
-   **`metric_type`**: (String(50), Not Null) 메트릭 종류 (예: `complexity`, `loc`, `duplication`)
-   **`metric_name`**: (String(100), Not Null) 메트릭 이름 (예: `cyclomatic_complexity`, `lines_of_code`)
-   **`value`**: (Float, Not Null) 메트릭 값
-   **`threshold`**: (Float) 경고 임계값
-   **`severity`**: (String(20)) 심각도 (예: `info`, `warning`, `error`)
-   **`created_at`**: (DateTime) 기록 생성 시간

## 22. 중복 (Duplicate)

중복 코드 블록의 해시 서명을 저장합니다.

-   **`duplicate_id`**: (Integer, Primary Key) 중복 고유 ID
-   **`hash_signature`**: (String(64), Not Null) 중복 코드 블록의 해시 서명
-   **`token_count`**: (Integer) 토큰 수
-   **`line_count`**: (Integer) 라인 수
-   **`created_at`**: (DateTime) 기록 생성 시간

## 23. 중복 인스턴스 (DuplicateInstance)

중복 코드 블록이 발견된 위치를 저장합니다.

-   **`instance_id`**: (Integer, Primary Key) 인스턴스 고유 ID
-   **`duplicate_id`**: (Integer, Foreign Key to `duplicates.duplicate_id`, Not Null) 중복 코드 블록 ID
-   **`file_id`**: (Integer, Foreign Key to `files.file_id`, Not Null) 중복이 발견된 파일 ID
-   **`start_line`**: (Integer, Not Null) 중복 코드 시작 라인
-   **`end_line`**: (Integer, Not Null) 중복 코드 종료 라인

## 24. 파싱 결과 모델 (ParseResultModel)

파일 파싱 결과에 대한 메타데이터를 저장합니다.

-   **`result_id`**: (Integer, Primary Key) 결과 고유 ID
-   **`file_id`**: (Integer, Foreign Key to `files.file_id`, Not Null) 파싱된 파일 ID
-   **`parser_type`**: (String(50), Not Null) 사용된 파서 타입 (예: `javalang`, `tree_sitter`)
-   **`success`**: (Boolean) 파싱 성공 여부
-   **`parse_time`**: (Float) 파싱 소요 시간 (초)
-   **`ast_complete`**: (Boolean) AST(추상 구문 트리) 완전성 여부
-   **`partial_ast`**: (Boolean) 부분적인 AST 생성 여부
-   **`fallback_used`**: (Boolean) 대체 파서 사용 여부
-   **`error_message`**: (Text) 오류 메시지
-   **`confidence`**: (Float) 파싱 결과의 신뢰도
-   **`created_at`**: (DateTime) 기록 생성 시간

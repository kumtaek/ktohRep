# SourceAnalyzer 새 폴더 마이그레이션 가이드

## 개요
현재 `E:\SourceAnalyzer.git`에 과거 소스와 섞여있는 파일들을 정리하여, `E:\SourceAnalyzer` 새 폴더에 필요한 파일만 이동하여 깨끗한 환경을 구축하는 가이드입니다.

## 1단계: 새 폴더 생성

```bash
mkdir E:\SourceAnalyzer
cd E:\SourceAnalyzer
```

## 2단계: 필요한 파일/폴더 복사

### 핵심 실행 스크립트 (3개)
```bash
copy "E:\SourceAnalyzer.git\generate_erd_html.py" E:\SourceAnalyzer\
copy "E:\SourceAnalyzer.git\generate_architecture_html.py" E:\SourceAnalyzer\
copy "E:\SourceAnalyzer.git\test_reports_auto.py" E:\SourceAnalyzer\
```

### 핵심 엔진 및 파서 (전체 폴더)
```bash
xcopy "E:\SourceAnalyzer.git\core" E:\SourceAnalyzer\core /E /I
xcopy "E:\SourceAnalyzer.git\parsers" E:\SourceAnalyzer\parsers /E /I
xcopy "E:\SourceAnalyzer.git\static" E:\SourceAnalyzer\static /E /I
```

### 샘플 데이터 및 설정 파일
```bash
copy "E:\SourceAnalyzer.git\sample_tables_no_fk.csv" E:\SourceAnalyzer\
```

### 프로젝트 샘플 소스 (분석 대상)
```bash
xcopy "E:\SourceAnalyzer.git\project\sampleSrc" E:\SourceAnalyzer\project\sampleSrc /E /I
```

### 문서 파일
```bash
copy "E:\SourceAnalyzer.git\EXECUTION_GUIDE.md" E:\SourceAnalyzer\
copy "E:\SourceAnalyzer.git\HTML_REPORTS_README.md" E:\SourceAnalyzer\
copy "E:\SourceAnalyzer.git\마이그레이션가이드.md" E:\SourceAnalyzer\
```

## 3단계: 메타데이터 생성 스크립트 추가

### phase1 메타데이터 생성 스크립트 생성
`phase1_enhanced_java.py` 파일을 새로 생성해야 합니다:

```python
"""
향상된 Java 메타데이터 생성 스크립트
"""
import sys
from pathlib import Path
sys.path.append(str(Path(__file__).parent))

def generate_metadata():
    print("메타데이터 생성기")
    print("=" * 50)
    
    try:
        from core.optimized_metadata_engine import OptimizedMetadataEngine
        from parsers.enhanced_relationship_extractor import EnhancedRelationshipExtractor
        from parsers.table_metadata_loader import TableMetadataLoader
        from parsers.mybatis_join_analyzer import MyBatisJoinAnalyzer
        import glob
        
        # 메타데이터 엔진 초기화
        print("메타데이터 엔진 초기화 중...")
        metadata_engine = OptimizedMetadataEngine(project_path="./project")
        project_id = metadata_engine.create_project("SourceAnalyzer", "./project")
        
        # CSV 테이블 로드
        print("CSV 테이블 로드 중...")
        table_loader = TableMetadataLoader(metadata_engine)
        csv_result = table_loader.load_tables_from_csv(project_id, "./sample_tables_no_fk.csv")
        print(f"CSV 테이블: {csv_result.get('table_count', 0)}개 로드")
        
        # MyBatis JOIN 관계 분석
        print("MyBatis JOIN 관계 분석 중...")
        join_analyzer = MyBatisJoinAnalyzer(metadata_engine)
        xml_directory = "./project/sampleSrc/src/main/resources/mybatis/mapper"
        join_result = join_analyzer.analyze_multiple_mybatis_files(
            project_id, xml_directory, csv_result.get('loaded_tables', {})
        )
        print(f"JOIN 관계: {join_result.get('join_count', 0)}개 분석")
        
        # Java 소스코드 관계 추출
        print("Java 소스코드 관계 추출 중...")
        relationship_extractor = EnhancedRelationshipExtractor(metadata_engine)
        java_files = glob.glob("./project/sampleSrc/src/main/java/**/*.java", recursive=True)
        java_result = relationship_extractor.extract_relationships_from_java(project_id, java_files)
        print(f"Java 파일: {len(java_files)}개 분석")
        
        # 비즈니스 태그 생성
        print("비즈니스 태그 생성 중...")
        relationship_extractor.add_business_tags_from_analysis(project_id)
        print("비즈니스 태그 생성 완료")
        
        print("\n[OK] 메타데이터 생성 완료!")
        print(f"   프로젝트 ID: {project_id}")
        print(f"   테이블: {csv_result.get('table_count', 0)}개")
        print(f"   JOIN 관계: {join_result.get('join_count', 0)}개")
        print(f"   Java 관계: {sum(java_result.get('summary', {}).values())}개")
        
    except Exception as e:
        print(f"[ERROR] 오류 발생: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    generate_metadata()
```

## 4단계: 폴더 구조 확인

마이그레이션 완료 후 다음과 같은 구조가 되어야 합니다:

```
E:\SourceAnalyzer\
├── phase1_enhanced_java.py              # 새로 생성 (메타데이터 생성)
├── generate_erd_html.py                 # ERD HTML 생성
├── generate_architecture_html.py        # 아키텍처 HTML 생성
├── test_reports_auto.py                 # 통합 텍스트 리포트
├── sample_tables_no_fk.csv              # 테이블 정의 파일
├── EXECUTION_GUIDE.md                   # 실행 가이드
├── HTML_REPORTS_README.md               # HTML 리포트 가이드
├── 마이그레이션가이드.md                 # 이 문서
├── core/                                # 핵심 엔진
│   └── optimized_metadata_engine.py
├── parsers/                             # 파서 모듈들
│   ├── enhanced_relationship_extractor.py
│   ├── table_metadata_loader.py
│   ├── mybatis_join_analyzer.py
│   ├── mermaid_html_reporter.py
│   └── (기타 파서들)
├── static/                              # 정적 리소스
│   └── mermaid.min.js
└── project/sampleSrc/                   # 분석 대상 소스
    ├── src/main/java/                   # Java 소스
    └── src/main/resources/mybatis/      # MyBatis XML
```

## 5단계: 동작 테스트

새 폴더에서 다음 순서로 테스트:

```bash
cd E:\SourceAnalyzer

# 1. 메타데이터 생성
python phase1_enhanced_java.py

# 2. ERD HTML 리포트 생성
python generate_erd_html.py

# 3. 아키텍처 HTML 리포트 생성
python generate_architecture_html.py

# 4. 통합 텍스트 리포트 생성
python test_reports_auto.py
```

## 6단계: 출력 확인

다음 파일들이 생성되는지 확인:

```
E:\SourceAnalyzer\
├── metadata_optimized.db                # 생성된 메타데이터 DB
└── project/sampleSrc/report/            # 리포트 출력
    ├── erd_mermaid_[timestamp].html
    ├── architecture_mermaid_[timestamp].html
    ├── ERD_Report_[timestamp].txt
    ├── Architecture_Report_[timestamp].txt
    ├── Visual_Architecture_Report_[timestamp].txt
    └── Combined_Report_[timestamp].txt
```

## 복사할 필요 없는 파일들 (기존 폴더에 남김)

다음 파일/폴더들은 과거 버전이거나 불필요한 파일들이므로 복사하지 않음:

- `phase1/`, `phase2/` - 과거 개발 버전
- `PROJECT/` - 과거 프로젝트 폴더
- `create_metadb/` - 과거 메타DB 생성 시스템
- `sampleSrc/` - 루트의 샘플소스 (project/sampleSrc만 사용)
- `20250901_*`, `20250902_*` - 과거 개발완료보고서들
- `PowerShell_*` - PowerShell 문제해결 가이드들
- `Q_*` - 과거 질문/답변 문서들
- `.git/` - Git 저장소 정보
- `__pycache__/` - Python 캐시 폴더들

## 완료 후 확인사항

1. **의존성 확인:** 모든 import가 정상 동작하는지 확인
2. **경로 확인:** 상대경로가 올바르게 설정되어 있는지 확인
3. **권한 확인:** 새 폴더에서 파일 생성/수정 권한이 있는지 확인
4. **기능 테스트:** 모든 주요 기능이 정상 동작하는지 확인

이 가이드를 따라 마이그레이션하면 깨끗하고 정돈된 SourceAnalyzer 환경을 구축할 수 있습니다.
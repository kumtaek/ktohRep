# 메타정보 생성에 종속된 기능들 분석

## 📅 작성일시
- **작성일**: 2025년 09월 04일 13시 30분
- **작성자**: Cursor AI Assistant
- **목적**: 메타데이터베이스 생성에 의존하는 기능들 식별

---

## 🔗 메타정보 생성 종속성 구조

### 메타정보 생성 (1단계)
```
메타정보 생성 (metadata.db)
├── main.py (메인 파서)
├── clean_parser.py (중복 제거 파서)
└── simple_parser_v2.py (간단 파서)
```

### 메타정보 종속 기능들 (2단계)
```
메타정보 종속 기능들
├── ERD 분석 및 리포트
│   ├── metadb_erd_analyzer.py
│   ├── metadb_erd_report_generator.py
│   ├── metadb_mermaid_erd_generator.py
│   ├── metadb_cytoscape_erd_generator.py
│   └── advanced_erd_generator.py
├── 계층도 분석
│   └── main.py의 _generate_hierarchy_report()
├── Mermaid ERD 생성
│   └── main.py의 _generate_mermaid_erd()
└── 기타 메타정보 활용 기능들
```

---

## 📋 메타정보 종속 기능 상세 목록

### 1. ERD 분석 및 리포트 생성 기능들

#### 1-1. 메타디비 ERD 분석기
**파일**: `metadb_erd_analyzer.py`
**종속성**: `metadata.db` 파일 존재 필수
**기능**: 메타데이터베이스에서 ERD 구조 분석

```python
class MetaDBERDAnalyzer:
    def analyze_erd(self) -> ERDStructure:
        # metadata.db에서 테이블, 컬럼, 관계 정보 추출
```

**실행 방법**:
```bash
# 직접 실행 (테스트용)
python test_metadb_erd.py
```

#### 1-2. 메타디비 ERD 리포트 생성기
**파일**: `metadb_erd_report_generator.py`
**종속성**: `MetaDBERDAnalyzer`의 분석 결과
**기능**: ERD 분석 결과를 마크다운 리포트로 생성

```python
class MetaDBERDReportGenerator:
    def generate_report(self, erd_structure: ERDStructure, output_path: str = None) -> str:
        # ERD 구조를 마크다운 형식으로 변환
```

#### 1-3. Mermaid ERD HTML 생성기
**파일**: `metadb_mermaid_erd_generator.py`
**종속성**: `MetaDBERDAnalyzer`의 분석 결과
**기능**: Mermaid 다이어그램 기반 HTML ERD 생성

```python
class MetaDBMermaidERDGenerator:
    def generate_html(self, erd_structure: ERDStructure, output_path: str = None) -> str:
        # Mermaid 다이어그램으로 HTML 생성
```

#### 1-4. Cytoscape ERD HTML 생성기
**파일**: `metadb_cytoscape_erd_generator.py`
**종속성**: `MetaDBERDAnalyzer`의 분석 결과
**기능**: Cytoscape.js 기반 인터랙티브 HTML ERD 생성

```python
class MetaDBCytoscapeERDGenerator:
    def generate_html(self, erd_structure: ERDStructure, output_path: str = None) -> str:
        # Cytoscape.js로 인터랙티브 ERD 생성
```

#### 1-5. 고급 ERD HTML 생성기
**파일**: `advanced_erd_generator.py`
**종속성**: `MetaDBERDAnalyzer`의 분석 결과
**기능**: 폐쇄망 대응 순수 HTML/CSS/JS ERD 생성

```python
class AdvancedERDGenerator:
    def generate_html(self, erd_structure: ERDStructure, output_path: str = None) -> str:
        # Magic MCP 스타일의 고급 ERD 생성
```

### 2. 계층도 분석 기능

#### 2-1. 메인 파서의 계층도 리포트 생성
**파일**: `main.py`의 `_generate_hierarchy_report()` 메서드
**종속성**: `metadata.db` 파일 존재 필수
**기능**: 메타데이터베이스에서 계층도 정보 추출하여 리포트 생성

```python
async def _generate_hierarchy_report(self, project_name: str, project_id: int) -> str:
    # metadata.db에서 계층도 정보 추출
    # HierarchyGenerator를 사용하여 리포트 생성
```

### 3. Mermaid ERD 생성 기능

#### 3-1. 메인 파서의 Mermaid ERD 생성
**파일**: `main.py`의 `_generate_mermaid_erd()` 메서드
**종속성**: `metadata.db` 파일 존재 필수
**기능**: 메타데이터베이스에서 ERD 정보 추출하여 Mermaid HTML 생성

```python
async def _generate_mermaid_erd(self, project_name: str, project_id: int) -> str:
    # metadata.db에서 ERD 정보 추출
    # MermaidErdGenerator를 사용하여 HTML 생성
```

### 4. 기타 메타정보 활용 기능들

#### 4-1. 메타데이터 상태 확인
**파일**: `check_metadata_status.py`
**종속성**: `metadata.db` 파일 존재 필수
**기능**: 메타데이터베이스 상태 및 내용 확인

#### 4-2. 데이터 품질 검증
**파일**: `validation/data_quality_validator.py`
**종속성**: `metadata.db` 파일 존재 필수
**기능**: 메타데이터베이스의 데이터 품질 검증

#### 4-3. 메트릭스 분석
**파일**: `tools/metrics.py`
**종속성**: `metadata.db` 파일 존재 필수
**기능**: 메타데이터베이스 기반 메트릭스 분석

---

## ⚠️ 종속성 실행 순서

### 필수 실행 순서
```
1. 메타정보 생성 (metadata.db 생성)
   ↓
2. 메타정보 종속 기능들 실행
```

### 1단계: 메타정보 생성 (필수)
```bash
# 방법 1: 메인 파서 사용 (권장)
python main.py --project-name sampleSrc --clean

# 방법 2: 간단 파서 사용 (테스트용)
python clean_parser.py

# 방법 3: 간단 파서 v2 사용 (테스트용)
python simple_parser_v2.py
```

### 2단계: 메타정보 종속 기능들 실행

#### ERD 분석 및 리포트 생성
```bash
# 1. ERD 분석
python test_metadb_erd.py

# 2. 개별 ERD 생성기들 (테스트용)
python metadb_erd_analyzer.py
python metadb_erd_report_generator.py
python metadb_mermaid_erd_generator.py
python metadb_cytoscape_erd_generator.py
python advanced_erd_generator.py
```

#### 통합 기능 실행
```bash
# 메인 파서로 모든 기능 실행
python main.py --project-name sampleSrc
```

---

## 🔍 종속성 확인 방법

### 1. 메타데이터베이스 존재 확인
```bash
# 파일 존재 확인
ls -la ../project/sampleSrc/metadata.db

# 파일 크기 확인 (0바이트가 아닌지)
stat ../project/sampleSrc/metadata.db
```

### 2. 메타데이터베이스 내용 확인
```bash
# SQLite로 내용 확인
sqlite3 ../project/sampleSrc/metadata.db ".tables"
sqlite3 ../project/sampleSrc/metadata.db "SELECT COUNT(*) FROM db_tables;"
sqlite3 ../project/sampleSrc/metadata.db "SELECT COUNT(*) FROM db_columns;"
```

### 3. 종속 기능 실행 전 체크
```python
# Python 코드로 확인
import os
from pathlib import Path

def check_metadata_dependency(project_name: str) -> bool:
    """메타데이터베이스 종속성 확인"""
    metadata_path = Path(f"../project/{project_name}/metadata.db")
    
    if not metadata_path.exists():
        print(f"❌ 메타데이터베이스를 찾을 수 없습니다: {metadata_path}")
        return False
    
    if metadata_path.stat().st_size == 0:
        print(f"❌ 메타데이터베이스가 비어있습니다: {metadata_path}")
        return False
    
    print(f"✅ 메타데이터베이스 확인 완료: {metadata_path}")
    return True
```

---

## 🚨 종속성 오류 해결 방법

### 1. 메타데이터베이스가 없는 경우
```bash
# 메타정보 생성 실행
python main.py --project-name sampleSrc --clean
```

### 2. 메타데이터베이스가 비어있는 경우
```bash
# 기존 DB 삭제 후 재생성
rm ../project/sampleSrc/metadata.db
python main.py --project-name sampleSrc --clean
```

### 3. 메타데이터베이스가 손상된 경우
```bash
# SQLite 무결성 검사
sqlite3 ../project/sampleSrc/metadata.db "PRAGMA integrity_check;"

# 손상된 경우 재생성
rm ../project/sampleSrc/metadata.db
python main.py --project-name sampleSrc --clean
```

---

## 📊 종속성별 실행 시간

### 메타정보 생성
- **메인 파서**: 30-60초
- **간단 파서**: 5-10초

### 메타정보 종속 기능들
- **ERD 분석**: 1-2초
- **ERD 리포트 생성**: 1-2초
- **Mermaid ERD HTML**: 2-3초
- **Cytoscape ERD HTML**: 3-5초
- **고급 ERD HTML**: 2-3초
- **계층도 분석**: 1-2초

---

## 🎯 권장 실행 시나리오

### 시나리오 1: 전체 메타정보 기반 분석
```bash
# 1단계: 메타정보 생성
python main.py --project-name sampleSrc --clean

# 2단계: 모든 ERD 기능 실행
python test_metadb_erd.py
```

### 시나리오 2: 특정 ERD 생성기만 실행
```bash
# 1단계: 메타정보 생성 (이미 있다면 생략)
python main.py --project-name sampleSrc --clean

# 2단계: 특정 ERD 생성기 실행
python advanced_erd_generator.py
```

### 시나리오 3: 메타정보 상태 확인
```bash
# 메타정보 상태 확인
python check_metadata_status.py

# 종속 기능 실행
python test_metadb_erd.py
```

---

## 💡 핵심 포인트

1. **메타정보 생성이 최우선**: 모든 ERD 및 계층도 분석 기능의 기반
2. **metadata.db 파일 필수**: 종속 기능들은 모두 이 파일에 의존
3. **순차 실행 필요**: 메타정보 생성 → 종속 기능 실행
4. **상태 확인 중요**: 실행 전 메타데이터베이스 상태 확인 필수
5. **오류 시 재생성**: 문제 발생 시 메타데이터베이스 재생성으로 해결

---

*메타정보 생성에 종속된 기능들은 모두 metadata.db 파일의 존재와 내용에 의존하므로, 안정적인 실행을 위해서는 메타정보 생성이 선행되어야 합니다.*

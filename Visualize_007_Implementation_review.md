# 시각화 MD/Mermaid Export 구현 심층 리뷰 (Visualize_007)

- 리뷰 버전: v1.2
- 작성 일시: 2025-08-28

---

## 종합 평가

이번 단계에서 MD/Mermaid 내보내기 기능이 완성되어 산출물 이식성(문서/위키/CI)과 협업 유틸리티가 크게 향상되었습니다. CLI 통합과 일부 한글화도 이뤄졌으며, ERD/그래프/시퀀스에 대한 기본 표기 규칙을 정립했습니다.

---

## 상세 점검 결과

- 기능 완성도: 양호
  - `.md`(전체 문서)와 `.mmd/.mermaid`(코드만) 동시 지원
  - ERD/시퀀스/그래프 3종 모두 동작
- 문서성: 보통
  - Visualize_007_Implementation.md 작성 완료
  - README 보완 필요(예시/스크린샷/자주 묻는 질문)
- 현지화: 부분 완료
  - CLI/빌더/에러 메시지 다수 한글화
  - HTML 템플릿 일부 버튼/문자열에 모지바케 존재 → 후속 수정 필요

---

## 문제점 및 원인/사유

1) HTML 템플릿 한글화 미완/모지바케
- 현상: `graph_view.html`, `erd_view.html`에 일부 버튼/레이블이 `??` 등으로 깨져 보임
- 원인: 이전 단계에서 텍스트 인코딩/치환 과정 중 일부 문자열이 손상
- 영향: 최종 사용자 UI 가독성 저하
- 조치 제안: 해당 파일의 한국어 문자열 일괄 교체 및 파일 인코딩(UTF-8) 확인, 브라우저에서 렌더링 재검증

2) 라벨 길이 제한(20자)로 인한 정보 손실 가능성
- 현상: Mermaid에서 긴 라벨 줄바꿈/레이아웃 문제가 있어 말줄임 적용
- 영향: 노드 식별이 어려울 수 있음
- 조치 제안: 옵션화(예: `--label-max=40`) 또는 툴팁/주석 섹션에 전체 라벨 병기

3) ERD 컬럼 표기 상한(10개)
- 현상: 가독성 위해 제한
- 영향: 스키마 인사이트가 필요한 경우 정보가 축약됨
- 조치 제안: 옵션화(`--erd-max-cols=NN`), Markdown 문서에 전체 컬럼 부록 섹션 추가 선택지 제공

4) Mermaid 그래프 표현력 한계
- 현상: 대규모 그래프에서 레이아웃 성능/가독성 저하
- 사유: Mermaid 자체 제약
- 조치 제안: 대형 그래프는 HTML(Cytoscape) 중심으로 안내, Mermaid는 부분 뷰(포커스/서브그래프) 위주 산출 옵션 추가

5) ID 정규화에 따른 충돌 가능성(희소)
- 현상: `_sanitize_id`에서 원본 ID → 안전 ID로 치환 시 앞 10자만 사용
- 영향: 간헐적으로 충돌 확률 존재(매우 낮음)
- 조치 제안: 해시 기반 후미 추가(ex: `n{counter}_{prefix}_{hash4}`)로 충돌 확률 추가 완화

6) 시퀀스 다이어그램의 참여자 결정 방식
- 현상: 엣지 집합으로부터 자동 수집
- 영향: 대형/혼합 데이터에서 의도치 않은 참여자 포함 가능
- 조치 제안: 시작 노드/패턴 기반 필터 옵션 제공(예: `--participants-include/--exclude`)

---

## 정확성 향상 제안(우선순위 포함)

- 우선 A: 관계 방향/종류 정확도 개선(ERD)
  - 원인: 조인 패턴 기반 추론 시 방향성/강도 판단이 모호할 수 있음
  - 제안: PK/FK 키 매칭 + 컬럼명 규칙 + 조인 빈도 다변량 스코어로 신뢰도 재산정, 방향성 결정 규칙 명시화

- 우선 A: Mermaid 화살표/라벨 일관성 강화
  - 사유: 표기 일관성이 정확한 해석에 중요함
  - 제안: unresolved는 항상 `-. kind .->`, resolved는 `-->|kind|` 규칙 고정, 테스트 케이스 추가

- 우선 B: 노드 라벨/메타 부가정보 병기
  - 사유: 말줄임으로 정보 손실을 보완
  - 제안: Markdown 본문에 "노드 상세" 표 섹션(선택) 추가, 또는 Mermaid 주석(%%)에 원문 라벨 주석화

- 우선 B: 포커스/깊이 기반 부분 산출
  - 사유: 대형 프로젝트 Mermaid 가독성 문제 해결
  - 제안: `--export-mermaid-focus` `--export-mermaid-depth` 같은 전용 옵션으로 부분 뷰 산출

- 우선 C: ID 충돌 완화
  - 제안: 안전 ID 생성 시 4~6자리 해시 추가

---

## 향후 개발 항목(체크리스트)

- [ ] HTML 템플릿 버튼/라벨 전면 한글화 및 모지바케 제거
- [ ] Mermaid 옵션화(레이아웃, 라벨 길이, ERD 컬럼 수)
- [ ] ERD 정확도 향상(방향/신뢰도 산정 규칙 강화)
- [ ] Mermaid 산출물 테스트 케이스 추가(스냅샷 기반)
- [ ] README 보완: 예시/스크린샷/FAQ
- [ ] ID 충돌 완화 로직(해시) 적용

---

## 결론

MD/Mermaid Export 기능은 실사용 가능한 수준으로 완성되었습니다. 다만 대형 그래프 지원성과 UI 한글화 완성도, ERD 방향성/정확도 향상 과제는 남아 있습니다. 본 리뷰의 개선안을 기준으로 추가 이터레이션을 진행하면 산출물 신뢰도와 사용자 경험이 더 좋아질 것입니다.


# 지침 개선 제안 - 메타디비 스키마 확인 필수

## 문제 상황
메타디비 검증 스크립트 작성 시 스키마를 정확히 파악하지 않고 예상으로 작성하여 에러 발생

## 원인 분석
1. **지침 53번째 줄**에 명시된 스키마 문서를 먼저 확인하지 않음
2. 메타디비 스키마를 직접 조회하지 않고 예상으로 스크립트 작성
3. 컬럼명, 테이블 구조를 정확히 파악하지 않음

## 지침 개선 제안

### 기존 지침 (53번째 줄)
```
- 'E:\SourceAnalyzer.git\Dev.Report\메타데이터베이스_스키마_및_현황_20250119_1520.md' 참고.
```

### 개선된 지침 제안
```
## 메타디비 스키마 확인 필수
- **메타디비 관련 작업 전 필수**: 'E:\SourceAnalyzer.git\Dev.Report\메타데이터베이스_스키마_및_현황_20250119_1520.md' 문서를 먼저 확인
- **스키마 검증**: 메타디비 스키마를 직접 조회하여 정확한 컬럼명, 테이블 구조 파악
- **스크립트 작성 전**: PRAGMA table_info() 또는 DESCRIBE 명령으로 실제 스키마 확인
- **예상 금지**: 스키마를 예상으로 추측하지 말고 반드시 실제 구조 확인 후 작업
```

### 추가 지침 제안
```
## 메타디비 작업 절차
1. **스키마 문서 확인**: 메타데이터베이스_스키마_및_현황_20250119_1520.md 참조
2. **실제 스키마 조회**: 
   ```python
   cursor.execute("PRAGMA table_info(table_name)")
   columns = cursor.fetchall()
   ```
3. **테이블 목록 확인**:
   ```python
   cursor.execute("SELECT name FROM sqlite_master WHERE type='table'")
   tables = cursor.fetchall()
   ```
4. **스크립트 작성**: 확인된 스키마 기반으로 작성
5. **검증**: 스크립트 실행 전 스키마 일치 여부 재확인
```

## 실제 스키마 정보 (확인됨)

### 주요 테이블 스키마
- **files**: file_id, project_id, path, language, hash, mtime, llm_summary, llm_summary_confidence
- **classes**: class_id, file_id, fqn, name, start_line, annotations, llm_summary, llm_summary_confidence  
- **methods**: method_id, file_id, class_id, name, start_line, end_line, parameters, return_type, annotations, llm_summary, llm_summary_confidence
- **sql_units**: sql_id, file_id, origin, mapper_ns, stmt_id, start_line, normalized_fingerprint, llm_summary, llm_summary_confidence
- **chunks**: chunk_id, target_type, target_id, token_count, hash, created_at
- **parse_results**: result_id, file_id, parser_type, success, parse_time, ast_complete, partial_ast, error_message, confidence, created_at

### 주의사항
- `file_type` → `language`
- `sql_unit_id` → `sql_id`  
- `has_error` → `success` (BOOLEAN)
- `chunk_type` → `target_type`

## 결론
메타디비 관련 작업 시 반드시 스키마 문서를 먼저 확인하고, 실제 스키마를 조회한 후 작업해야 함

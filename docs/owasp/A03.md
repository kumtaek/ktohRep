# A03: Injection (인젝션)

## 개요
신뢰할 수 없는 입력이 쿼리/명령/템플릿에 삽입되어 실행되는 취약점입니다. 대표적으로 SQL Injection, OS Command Injection, NoSQL/LDAP/Template Injection이 있습니다.

## 공격 시나리오
- 로그인 우회: `' OR '1'='1` 등으로 WHERE 절을 무력화
- 데이터 유출: `UNION SELECT`로 민감정보 덤프
- 데이터 변조/삭제: `UPDATE/DELETE` 주입
- RCE로 확장: SQL 함수/XP_CMDSHELL/DBMS_SCHEDULER 등 악용(환경 의존)

## 취약 코드 (나쁜 예)
### Java(JDBC)
```java
String sql = "SELECT * FROM users WHERE username='" + user + "' AND pw='" + pw + "'";
try (Statement st = conn.createStatement();
     ResultSet rs = st.executeQuery(sql)) {
  // ...
}
```

### MyBatis (동적 SQL, 잘못된 바인딩)
```xml
<select id="findUser" resultType="User">
  SELECT * FROM users WHERE username = ${username}
</select>
```
`${}`는 문자열 치환으로 인젝션 위험.

### JSP (명령 주입 가능성)
```jsp
<%
  String cmd = request.getParameter("cmd");
  Runtime.getRuntime().exec("/bin/sh -c " + cmd);
%>
```

## 안전 코드 (좋은 예)
### Java(JDBC PreparedStatement)
```java
String sql = "SELECT * FROM users WHERE username=? AND pw=?";
try (PreparedStatement ps = conn.prepareStatement(sql)) {
  ps.setString(1, user);
  ps.setString(2, pw);
  try (ResultSet rs = ps.executeQuery()) { /* ... */ }
}
```

### MyBatis (#{} 바인딩)
```xml
<select id="findUser" resultType="User">
  SELECT * FROM users WHERE username = #{username}
</select>
```

### 입력 검증 & 최소권한
- 화이트리스트 기반 검증(허용 문자/패턴)
- DB 계정 최소권한(SELECT/필요 테이블 한정), 에러 메시지 최소화

## 탐지/검증 포인트
- 문자열 결합으로 쿼리 생성 여부
- MyBatis `${}` 사용 여부 (가능하면 `#{}` 사용)
- JSP/서버 코드에서 외부 입력으로 시스템 명령/템플릿 직접 실행 여부
- 테스트 페이로드 주입 시 비정상 결과/오류 노출

## 체크리스트
- [ ] 모든 DB 쿼리는 파라미터 바인딩 사용
- [ ] 동적 테이블/컬럼 이름이 필요한 경우 화이트리스트 매핑 후 사용
- [ ] MyBatis `${}` 사용 금지(불가피하면 강력한 검증 및 이스케이프)
- [ ] 상세 DB 에러 메시지 노출 금지(로깅만)
- [ ] 최소권한의 DB 계정 사용, 감사 로그 기록

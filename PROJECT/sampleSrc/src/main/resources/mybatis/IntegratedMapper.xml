<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.integrated.IntegratedMapper">

  <sql id="BaseColumns">
    ORDER_ID, CUSTOMER_ID, TOTAL_AMOUNT, STATUS, DEL_YN
  </sql>

  <!-- Dynamic SQL with bind/choose/foreach/if/where/include -->
  <select id="findDynamicData" parameterType="map" resultType="map">
    <bind name="likeName" value="'%' || name || '%'"/>
    SELECT
      <include refid="BaseColumns"/>
    FROM ORDERS
    <where>
      <if test="status != null">
        STATUS = #{status}
      </if>
      <if test="name != null">
        AND CUSTOMER_ID IN (
          SELECT CUSTOMER_ID FROM CUSTOMERS WHERE CUSTOMER_NAME LIKE #{likeName}
        )
      </if>
      <if test="ids != null and ids.size() > 0">
        AND ORDER_ID IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
          #{id}
        </foreach>
      </if>
      AND DEL_YN = 'N'
      <choose>
        <when test="minTotal != null"> AND TOTAL_AMOUNT &gt;= #{minTotal} </when>
        <otherwise> AND TOTAL_AMOUNT &gt;= 0 </otherwise>
      </choose>
    </where>
  </select>

  <!-- CTE/Subquery and ANSI JOIN example -->
  <select id="getComplexReport" resultType="map">
    WITH recent_orders AS (
      SELECT ORDER_ID, CUSTOMER_ID, ORDER_DATE
      FROM ORDERS
      WHERE ORDER_DATE &gt;= SYSDATE - 30
    )
    SELECT o.ORDER_ID, c.CUSTOMER_NAME, p.PRODUCT_NAME
    FROM recent_orders o
    JOIN ORDER_ITEMS oi ON o.ORDER_ID = oi.ORDER_ID
    JOIN PRODUCTS p ON oi.PRODUCT_ID = p.PRODUCT_ID
    JOIN CUSTOMERS c ON o.CUSTOMER_ID = c.CUSTOMER_ID
    WHERE p.DEL_YN = 'N'
  </select>

  <!-- ANSI JOIN -->
  <select id="getOrdersWithCustomerAnsiJoin" parameterType="string" resultType="map">
    SELECT o.ORDER_ID, c.CUSTOMER_NAME
    FROM ORDERS o
    JOIN CUSTOMERS c ON o.CUSTOMER_ID = c.CUSTOMER_ID
    WHERE o.CUSTOMER_ID = #{customerId}
  </select>

  <!-- Oracle implicit JOIN syntax -->
  <select id="getOrdersWithCustomerImplicitJoin" parameterType="string" resultType="map">
    SELECT o.ORDER_ID, c.CUSTOMER_NAME
    FROM ORDERS o, CUSTOMERS c
    WHERE o.CUSTOMER_ID = c.CUSTOMER_ID
      AND o.CUSTOMER_ID = #{customerId}
  </select>

</mapper>


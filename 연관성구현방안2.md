## 연관성 구현 방안

1. **메타데이터 구조 확장**
   
   - `phase1` 분석 결과에 “연관성”을 표현하는 필드(예: `related_nodes`, `relation_score`, `cluster_id`)를 추가해 각 객체 사이의 근접성을 수치화합니다.
   
   - 연관성 판단 규칙
     
     - 호출/사용 관계: 메서드 호출, SQL‧테이블 참조, 상속·구현 관계 등 기존 메타정보 기반
     
     - 구조적 유사성: 동일 패키지·모듈·폴더 또는 공통 네이밍 패턴
   
   - 위 규칙으로 연관성이 모호할 때는 LLM을 활용해 소스나 SQL 문장을 분석하고, 결과를 `relation_score`에 반영합니다.

2. **규칙 기반 연관성 추출 로직 구현**
   
   - `phase1`의 분석기에서 호출 그래프·의존성·테이블 매핑 정보를 수집해 객체 간 연관 점수를 계산합니다.
   
   - 점수 기준 예시
     
     | 규칙               | 점수  |
     | ---------------- | --- |
     | 직접 호출/참조         | +3  |
     | 동일 테이블 또는 DAO 공유 | +2  |
     | 동일 패키지/모듈        | +1  |
   
   - 연관성이 일정 임계값 이상이면 `related_nodes`에 대상 ID와 점수를 기록합니다.

3. **LLM/비정형 분석 활용**
   
   - 규칙 기반으로 점수를 정하기 어려운 경우, `phase1/llm_cli.py` 등의 LLM 모듈을 호출해
     
     - 파일/클래스/SQL 간의 의미적 관련성을 요약
     
     - 결과를 `relation_score`에 보정값으로 반영
   
   - LLM 호출은 캐시하거나 비동기 처리해 성능 저하를 최소화합니다.

4. **군집화 및 배치 알고리즘 도입**
   
   - `visualize/templates/cyto_base.html`의 `dagre` 레이아웃은 좌→우(`rankDir: 'LR'`) 배치만을 지원하여 노드가 가로로 길게 늘어지는 문제가 있습니다.
   
   - 연관성 점수를 가중치로 사용해 그래프 군집화(Louvain, Girvan–Newman 등) 또는 force-directed(`cose`, `fcose`) 레이아웃으로 전환합니다.
   
   - `cyto_base.html`과 `resetView()`에서 레이아웃 옵션을 파라미터화하여 사용자/CLI에서 레이아웃을 선택할 수 있게 합니다.

5. **클러스터 시각화**
   
   - 군집 결과(`cluster_id`)를 노드 메타에 포함하고, `visualize/schema.py`에서 이를 기반으로 색상·경계 상자·캡션을 부여합니다.
   
   - 확대/축소 시 클러스터 단위로 확장·접기 기능을 추가해 전체 구조와 세부를 모두 보기 쉽게 합니다.

6. **ERD 및 기타 보고서 반영**
   
   - `visualize/builders/erd.py` 등 모든 builder에서 `relation_score`와 `cluster_id`를 읽어, 노드를 클러스터별로 묶고 관계선을 재배치합니다.
   
   - HTML/Markdown 보고서 생성 시에도 클러스터별 구역이나 목차를 제공해 관련 객체를 한눈에 파악할 수 있게 합니다.

7. **검증 및 튜닝**
   
   - 실제 프로젝트(`PROJECT/<name>/src`, `db_schema`)에 대해 연관성 계산 → 군집화 → 시각화 과정을 테스트하고,
   
   - 객체 수가 많을 때의 성능과 가독성을 검증합니다.
   
   - 사용자 피드백을 반영해 연관성 가중치와 레이아웃 파라미터를 조정합니다.

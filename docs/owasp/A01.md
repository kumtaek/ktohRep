# A01: Broken Access Control (접근 제어 취약점)

## 개요
권한 검증이 부정확하거나 누락되어 사용자가 허용된 범위를 넘어서는 리소스와 기능에 접근하는 취약점입니다.

## 대표 징후
- 직접 객체 참조(IDOR): URL/파라미터 변경으로 타인의 데이터 열람/수정
- 관리자 기능 노출, 서버측 권한 체크 누락
- 클라이언트 사이드에서만 권한 판단(자바스크립트에만 의존)

## 영향
- 개인정보/기밀 정보 유출, 데이터 변조, 계정 탈취, 시스템 장악

## 대응 방안
- 서버측 강제 접근제어(Authorization) 일관 적용(모든 요청)
- 최소 권한 원칙, 역할/권한 매핑 중앙화
- URL/메서드/데이터 레벨 권한 검증 및 거부 기본값(deny-by-default)
- 대체 식별자 사용(예: 무작위 토큰), ID 추측 방지

## 취약 코드 (나쁜 예)
```java
// GET /api/users?userId=123  → 파라미터로 임의 사용자 조회
@GetMapping("/api/users")
public User getUser(@RequestParam int userId) {
  return userService.findById(userId); // 소유자 검증 없음
}
```

## 안전 코드 (좋은 예)
```java
@GetMapping("/api/users/me")
public User getMe(Authentication auth) {
  int myId = ((CustomUser) auth.getPrincipal()).getUserId();
  return userService.findById(myId);
}

@GetMapping("/api/users/{id}")
@PreAuthorize("hasRole('ADMIN') or @ownershipChecker.isOwner(#id)")
public User getById(@PathVariable int id) {
  return userService.findById(id);
}
```

## 탐지/검증 포인트
- 리소스 소유자/역할 검증이 서버측에 구현되어 있는가?
- URL/파라미터 변경 시 다른 사용자 데이터 접근이 가능한가?
- 캐시/리다이렉트/파일 다운로드 경로에서 권한 검증이 누락되지 않았는가?

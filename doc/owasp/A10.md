# A10: Server-Side Request Forgery (SSRF)

## 개요
서버가 외부/내부로 요청을 보내는 기능을 악용해 내부망/메타데이터 서비스 접근 등으로 이어지는 취약점입니다.

## 대표 징후
- 입력된 URL을 서버가 그대로 요청, 내부 IP/프로토콜 필터링 부재
- DNS 재바인딩/리다이렉트 우회에 취약

## 대응 방안
- 아웃바운드 요청 화이트리스트, 내부 주소/프로토콜 차단
- URL 정상화/검증, 리다이렉트 제한, SSRF 프록시/샌드박스
- 크리덴셜/메타데이터 엔드포인트 접근 차단

## 취약/안전 코드 예시
### 취약 (임의 URL 프록시)
```python
import requests
def fetch(url):
    resp = requests.get(url, timeout=3)
    return resp.text
```

### 안전 (화이트리스트 + 내부망 차단)
```python
from urllib.parse import urlparse
import ipaddress, socket, requests

ALLOWED_HOSTS = {"docs.example.com", "api.example.com"}
def is_private(host):
    ip = socket.gethostbyname(host)
    return ipaddress.ip_address(ip).is_private

def fetch_safe(url):
    u = urlparse(url)
    if u.scheme not in {"https","http"}:
        raise ValueError("scheme not allowed")
    if u.hostname not in ALLOWED_HOSTS:
        raise ValueError("host not allowed")
    if is_private(u.hostname):
        raise ValueError("private network blocked")
    return requests.get(url, timeout=3, allow_redirects=False).text
```

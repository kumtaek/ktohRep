<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Source Analyzer - 시퀀스 다이어그램</title>
    <link rel="stylesheet" href="./static/css/woori-brand-theme.css">
    <style>
        body, html { 
            margin: 0; 
            height: 100%; 
            font-family: 'Malgun Gothic', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--woori-ice);
        }
        
        .woori-header {
            background: var(--woori-gradient-header);
            color: var(--woori-text-on-primary);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--woori-shadow-medium);
        }
        
        .woori-logo {
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 600;
        }
        
        #toolbar { 
            padding: 16px 24px; 
            background: white;
            border-bottom: var(--woori-border-light);
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            box-shadow: 0 2px 4px rgba(25,118,210,0.08);
        }
        
        button {
            background: var(--woori-gradient-main);
            border: none;
            color: var(--woori-text-on-primary);
            padding: 10px 16px;
            border-radius: var(--woori-border-radius-small);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: var(--woori-shadow-light);
        }
        button:hover {
            background: var(--woori-primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--woori-shadow-medium);
        }
        
        #diagram-container { 
            width: 100%; 
            height: calc(100% - 120px);
            overflow: hidden;
            position: relative;
            background: white;
            border: 1px solid #e0e0e0;
            margin: 16px;
            border-radius: 8px;
        }
        
        #diagram {
            width: 100%;
            height: 100%;
            transform-origin: 0 0;
            transition: transform 0.3s ease;
        }
        
        .zoom-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 100;
        }
        
        .zoom-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--woori-primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .zoom-btn:hover {
            background: var(--woori-primary-dark);
        }
        
        .stats {
            background: var(--woori-primary-pale);
            color: var(--woori-primary);
            padding: 10px 16px;
            border-radius: var(--woori-border-radius-small);
            font-size: 13px;
            font-weight: 500;
            border: 1px solid rgba(25,118,210,0.15);
        }
    </style>
    <script src="./static/vendor/cytoscape/cytoscape.min.js"></script>
    <script src="./static/vendor/dagre/dagre.min.js"></script>
    <script src="./static/vendor/cytoscape-dagre/cytoscape-dagre.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>
    <!-- 헤더 -->
    <header class="woori-header">
        <div class="header-title">
            <div class="woori-logo">우</div>
            <span>Source Analyzer - 시퀀스 다이어그램</span>
        </div>
        <div style="font-size: 14px; opacity: 0.9;">Enterprise Solution</div>
    </header>
    
    <div id="toolbar">
        <button onclick="resetZoom()" title="화면에 맞추기">🔍 화면맞춤</button>
        <button onclick="exportPng()" title="PNG로 내보내기">📷 PNG 저장</button>
        <button onclick="switchLayout()" title="레이아웃 변경">🔄 레이아웃</button>
        <div class="stats" id="stats">
            노드: <span id="node-count">0</span> | 
            메시지: <span id="edge-count">0</span>
        </div>
    </div>
    
    <div id="diagram-container">
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="zoomIn()" title="확대">+</button>
            <button class="zoom-btn" onclick="zoomOut()" title="축소">−</button>
        </div>
        <div id="diagram"></div>
    </div>

    <script>
        const DATA = {
  "nodes": [
    {
      "id": "method:6",
      "type": "method",
      "label": "doWork()",
      "group": "control",
      "meta": {
        "name": "doWork",
        "signature": "doWork()",
        "class": "com.example.integrated.IntegratedService",
        "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
        "line": 13,
        "llm_summary": "알겠습니다. 제공해주신 Java 메서드 코드를 분석하고 간결하게 요약해 드리겠습니다. 코드를 제공해주세요."
      }
    },
    {
      "id": "method:8",
      "type": "method",
      "label": "IntegratedService.calculateOrderTotal()",
      "group": "control",
      "meta": {
        "name": "calculateOrderTotal",
        "signature": "calculateOrderTotal(List items)",
        "class": "com.example.integrated.IntegratedService",
        "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
        "line": 28,
        "llm_summary": "알겠습니다. Java 메서드 `calculateOrderTotal`의 기능을 간략하게 요약하면 다음과 같습니다.\n\n**코드:** (코드 제공 필요)\n\n**요약:** 이 메서드는 주어진 주문 항목의 가격을 합산하여 총 결제 금액을 계산합니다."
      }
    },
    {
      "id": "method:9",
      "type": "method",
      "label": "IntegratedService.getFormattedId()",
      "group": "control",
      "meta": {
        "name": "getFormattedId",
        "signature": "getFormattedId(String id)",
        "class": "com.example.integrated.IntegratedService",
        "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
        "line": 36,
        "llm_summary": "알겠습니다. 제공된 Java 메서드 `getFormattedId`에 대한 간결한 요약입니다.\n\n**코드:** (코드 제공 필요)\n\n**요약:**  `getFormattedId` 메서드는 주어진 입력값을 기반으로 사용자에게 유효하고 보기 좋게 형식이 지정된 고유한 ID를 반환합니다."
      }
    },
    {
      "id": "method:7",
      "type": "method",
      "label": "IntegratedService.getStaticUserData()",
      "group": "control",
      "meta": {
        "name": "getStaticUserData",
        "signature": "getStaticUserData(String id)",
        "class": "com.example.integrated.IntegratedService",
        "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
        "line": 24,
        "llm_summary": "알겠습니다. 코드 내용을 알려주시면 분석 및 요약 작업을 진행하겠습니다. 코드 내용을 제공해주세요."
      }
    },
    {
      "id": "method:10",
      "type": "method",
      "label": "IntegratedService.log()",
      "group": "control",
      "meta": {
        "name": "log",
        "signature": "log(String msg)",
        "class": "com.example.integrated.IntegratedService",
        "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
        "line": 40,
        "llm_summary": "알겠습니다. 제공된 Java 메서드 코드의 내용을 분석하고 간결하게 요약해 드리겠습니다. 코드와 함께 분석 내용을 제공해 드리겠습니다."
      }
    }
  ],
  "edges": [
    {
      "id": "seq_edge_0",
      "source": "method:6",
      "target": "method:8",
      "kind": "call",
      "confidence": 0.8,
      "meta": {
        "sequence_order": 0,
        "message": "call IntegratedService.calculateOrderTotal()",
        "unresolved": false
      }
    },
    {
      "id": "seq_edge_1",
      "source": "method:6",
      "target": "method:9",
      "kind": "call",
      "confidence": 0.8,
      "meta": {
        "sequence_order": 1,
        "message": "call IntegratedService.getFormattedId()",
        "unresolved": false
      }
    },
    {
      "id": "seq_edge_2",
      "source": "method:6",
      "target": "method:7",
      "kind": "call",
      "confidence": 0.8,
      "meta": {
        "sequence_order": 2,
        "message": "call IntegratedService.getStaticUserData()",
        "unresolved": false
      }
    },
    {
      "id": "seq_edge_3",
      "source": "method:6",
      "target": "method:10",
      "kind": "call",
      "confidence": 0.8,
      "meta": {
        "sequence_order": 3,
        "message": "call IntegratedService.log()",
        "unresolved": false
      }
    }
  ],
  "metadata": {
    "node_count": 5,
    "edge_count": 4,
    "node_types": [
      "method"
    ],
    "edge_kinds": [
      "call"
    ]
  },
  "mermaid": "sequenceDiagram\n    participant method_6 as doWork()\n    participant method_8 as IntegratedService.calculateOrderTotal()\n    participant method_9 as IntegratedService.getFormattedId()\n    participant method_7 as IntegratedService.getStaticUserData()\n    participant method_10 as IntegratedService.log()\n\n    method_6->>method_8: call IntegratedService.calculateOrderTotal()\n    method_6->>method_9: call IntegratedService.getFormattedId()\n    method_6->>method_7: call IntegratedService.getStaticUserData()\n    method_6->>method_10: call IntegratedService.log()",
  "type": "sequence_diagram",
  "participants": [
    {
      "id": "method:6",
      "type": "method",
      "label": "doWork()",
      "actor_type": "control",
      "order": 0,
      "details": {
        "name": "doWork",
        "signature": "doWork()",
        "class": "com.example.integrated.IntegratedService",
        "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
        "line": 13,
        "llm_summary": "알겠습니다. 제공해주신 Java 메서드 코드를 분석하고 간결하게 요약해 드리겠습니다. 코드를 제공해주세요."
      }
    },
    {
      "id": "method:8",
      "type": "method",
      "label": "IntegratedService.calculateOrderTotal()",
      "actor_type": "control",
      "order": 1,
      "details": {
        "name": "calculateOrderTotal",
        "signature": "calculateOrderTotal(List items)",
        "class": "com.example.integrated.IntegratedService",
        "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
        "line": 28,
        "llm_summary": "알겠습니다. Java 메서드 `calculateOrderTotal`의 기능을 간략하게 요약하면 다음과 같습니다.\n\n**코드:** (코드 제공 필요)\n\n**요약:** 이 메서드는 주어진 주문 항목의 가격을 합산하여 총 결제 금액을 계산합니다."
      }
    },
    {
      "id": "method:9",
      "type": "method",
      "label": "IntegratedService.getFormattedId()",
      "actor_type": "control",
      "order": 2,
      "details": {
        "name": "getFormattedId",
        "signature": "getFormattedId(String id)",
        "class": "com.example.integrated.IntegratedService",
        "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
        "line": 36,
        "llm_summary": "알겠습니다. 제공된 Java 메서드 `getFormattedId`에 대한 간결한 요약입니다.\n\n**코드:** (코드 제공 필요)\n\n**요약:**  `getFormattedId` 메서드는 주어진 입력값을 기반으로 사용자에게 유효하고 보기 좋게 형식이 지정된 고유한 ID를 반환합니다."
      }
    },
    {
      "id": "method:7",
      "type": "method",
      "label": "IntegratedService.getStaticUserData()",
      "actor_type": "control",
      "order": 3,
      "details": {
        "name": "getStaticUserData",
        "signature": "getStaticUserData(String id)",
        "class": "com.example.integrated.IntegratedService",
        "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
        "line": 24,
        "llm_summary": "알겠습니다. 코드 내용을 알려주시면 분석 및 요약 작업을 진행하겠습니다. 코드 내용을 제공해주세요."
      }
    },
    {
      "id": "method:10",
      "type": "method",
      "label": "IntegratedService.log()",
      "actor_type": "control",
      "order": 4,
      "details": {
        "name": "log",
        "signature": "log(String msg)",
        "class": "com.example.integrated.IntegratedService",
        "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
        "line": 40,
        "llm_summary": "알겠습니다. 제공된 Java 메서드 코드의 내용을 분석하고 간결하게 요약해 드리겠습니다. 코드와 함께 분석 내용을 제공해 드리겠습니다."
      }
    }
  ],
  "interactions": [
    {
      "id": "interaction_0",
      "sequence_order": 0,
      "type": "synchronous",
      "from_participant": "method:6",
      "to_participant": "method:8",
      "message": "call IntegratedService.calculateOrderTotal()",
      "confidence": 0.8,
      "unresolved": false,
      "depth": 0,
      "style": "solid",
      "meta": {
        "edge_kind": "call",
        "caller_details": {
          "name": "doWork",
          "signature": "doWork()",
          "class": "com.example.integrated.IntegratedService",
          "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
          "line": 13,
          "llm_summary": "알겠습니다. 제공해주신 Java 메서드 코드를 분석하고 간결하게 요약해 드리겠습니다. 코드를 제공해주세요."
        },
        "target_details": {
          "name": "calculateOrderTotal",
          "signature": "calculateOrderTotal(List items)",
          "class": "com.example.integrated.IntegratedService",
          "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
          "line": 28,
          "llm_summary": "알겠습니다. Java 메서드 `calculateOrderTotal`의 기능을 간략하게 요약하면 다음과 같습니다.\n\n**코드:** (코드 제공 필요)\n\n**요약:** 이 메서드는 주어진 주문 항목의 가격을 합산하여 총 결제 금액을 계산합니다."
        }
      }
    },
    {
      "id": "interaction_1",
      "sequence_order": 1,
      "type": "synchronous",
      "from_participant": "method:6",
      "to_participant": "method:9",
      "message": "call IntegratedService.getFormattedId()",
      "confidence": 0.8,
      "unresolved": false,
      "depth": 0,
      "style": "solid",
      "meta": {
        "edge_kind": "call",
        "caller_details": {
          "name": "doWork",
          "signature": "doWork()",
          "class": "com.example.integrated.IntegratedService",
          "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
          "line": 13,
          "llm_summary": "알겠습니다. 제공해주신 Java 메서드 코드를 분석하고 간결하게 요약해 드리겠습니다. 코드를 제공해주세요."
        },
        "target_details": {
          "name": "getFormattedId",
          "signature": "getFormattedId(String id)",
          "class": "com.example.integrated.IntegratedService",
          "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
          "line": 36,
          "llm_summary": "알겠습니다. 제공된 Java 메서드 `getFormattedId`에 대한 간결한 요약입니다.\n\n**코드:** (코드 제공 필요)\n\n**요약:**  `getFormattedId` 메서드는 주어진 입력값을 기반으로 사용자에게 유효하고 보기 좋게 형식이 지정된 고유한 ID를 반환합니다."
        }
      }
    },
    {
      "id": "interaction_2",
      "sequence_order": 2,
      "type": "synchronous",
      "from_participant": "method:6",
      "to_participant": "method:7",
      "message": "call IntegratedService.getStaticUserData()",
      "confidence": 0.8,
      "unresolved": false,
      "depth": 0,
      "style": "solid",
      "meta": {
        "edge_kind": "call",
        "caller_details": {
          "name": "doWork",
          "signature": "doWork()",
          "class": "com.example.integrated.IntegratedService",
          "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
          "line": 13,
          "llm_summary": "알겠습니다. 제공해주신 Java 메서드 코드를 분석하고 간결하게 요약해 드리겠습니다. 코드를 제공해주세요."
        },
        "target_details": {
          "name": "getStaticUserData",
          "signature": "getStaticUserData(String id)",
          "class": "com.example.integrated.IntegratedService",
          "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
          "line": 24,
          "llm_summary": "알겠습니다. 코드 내용을 알려주시면 분석 및 요약 작업을 진행하겠습니다. 코드 내용을 제공해주세요."
        }
      }
    },
    {
      "id": "interaction_3",
      "sequence_order": 3,
      "type": "synchronous",
      "from_participant": "method:6",
      "to_participant": "method:10",
      "message": "call IntegratedService.log()",
      "confidence": 0.8,
      "unresolved": false,
      "depth": 0,
      "style": "solid",
      "meta": {
        "edge_kind": "call",
        "caller_details": {
          "name": "doWork",
          "signature": "doWork()",
          "class": "com.example.integrated.IntegratedService",
          "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
          "line": 13,
          "llm_summary": "알겠습니다. 제공해주신 Java 메서드 코드를 분석하고 간결하게 요약해 드리겠습니다. 코드를 제공해주세요."
        },
        "target_details": {
          "name": "log",
          "signature": "log(String msg)",
          "class": "com.example.integrated.IntegratedService",
          "file": "PROJECT\\sampleSrc\\src\\main\\java\\com\\example\\integrated\\IntegratedService.java",
          "line": 40,
          "llm_summary": "알겠습니다. 제공된 Java 메서드 코드의 내용을 분석하고 간결하게 요약해 드리겠습니다. 코드와 함께 분석 내용을 제공해 드리겠습니다."
        }
      }
    }
  ]
};
        let currentZoom = 1;
        let currentLayout = 'dagre';
        let cy;

        // Cytoscape 스타일과 레이아웃 초기화
        function initCytoscape() {
            if (!DATA.nodes || !DATA.edges) {
                // Fallback to Mermaid if no graph data
                initMermaid();
                return;
            }

            const elements = [];
            
            // 노드 추가
            for (const node of DATA.nodes || []) {
                elements.push({
                    data: {
                        id: node.id,
                        label: node.label,
                        type: node.type
                    }
                });
            }
            
            // 엣지 추가
            for (const edge of DATA.edges || []) {
                elements.push({
                    data: {
                        id: edge.id,
                        source: edge.source,
                        target: edge.target,
                        label: edge.meta?.message || ''
                    }
                });
            }

            cy = cytoscape({
                container: document.getElementById('diagram'),
                elements: elements,
                style: [
                    {
                        selector: 'node',
                        style: {
                            'label': 'data(label)',
                            'font-size': '12px',
                            'text-wrap': 'wrap',
                            'text-max-width': '120px',
                            'text-valign': 'center',
                            'text-halign': 'center',
                            'background-color': '#e3f2fd',
                            'border-width': 2,
                            'border-color': '#1976d2',
                            'width': 'mapData(label.length, 10, 50, 80, 200)',
                            'height': '60px',
                            'shape': 'round-rectangle'
                        }
                    },
                    {
                        selector: 'edge',
                        style: {
                            'curve-style': 'bezier',
                            'width': 2,
                            'line-color': '#1976d2',
                            'target-arrow-shape': 'triangle',
                            'target-arrow-color': '#1976d2',
                            'label': 'data(label)',
                            'font-size': '10px',
                            'text-rotation': 'autorotate',
                            'color': '#333'
                        }
                    }
                ],
                layout: {
                    name: 'dagre',
                    rankDir: 'TB',
                    animate: true,
                    animationDuration: 500
                }
            });

            // 통계 업데이트
            document.getElementById('node-count').textContent = DATA.nodes?.length || 0;
            document.getElementById('edge-count').textContent = DATA.edges?.length || 0;
        }

        // Mermaid 초기화 (백업용)
        function initMermaid() {
            const diagramElement = document.getElementById('diagram');
            if (DATA.mermaid) {
                diagramElement.innerHTML = '<div class="mermaid">' + DATA.mermaid + '</div>';
                mermaid.initialize({ 
                    startOnLoad: true,
                    theme: 'default',
                    sequence: {
                        diagramMarginX: 50,
                        diagramMarginY: 50,
                        actorMargin: 50,
                        width: 150,
                        height: 65,
                        boxMargin: 10,
                        boxTextMargin: 5,
                        noteMargin: 10,
                        messageMargin: 35,
                        mirrorActors: false,
                        bottomMarginAdj: 1,
                        useMaxWidth: true
                    }
                });
                mermaid.run();
            }
        }

        function zoomIn() {
            if (cy) {
                cy.zoom(cy.zoom() * 1.2);
                cy.center();
            } else {
                currentZoom *= 1.2;
                const diagram = document.getElementById('diagram');
                diagram.style.transform = `scale(${currentZoom})`;
            }
        }

        function zoomOut() {
            if (cy) {
                cy.zoom(cy.zoom() * 0.8);
                cy.center();
            } else {
                currentZoom *= 0.8;
                const diagram = document.getElementById('diagram');
                diagram.style.transform = `scale(${currentZoom})`;
            }
        }

        function resetZoom() {
            if (cy) {
                cy.fit();
            } else {
                currentZoom = 1;
                const diagram = document.getElementById('diagram');
                diagram.style.transform = `scale(${currentZoom})`;
            }
        }

        function switchLayout() {
            if (!cy) return;
            
            currentLayout = currentLayout === 'dagre' ? 'breadthfirst' : 'dagre';
            const layoutConfig = currentLayout === 'dagre' ? 
                { name: 'dagre', rankDir: 'TB', animate: true, animationDuration: 500 } :
                { name: 'breadthfirst', directed: true, animate: true, animationDuration: 500 };
                
            cy.layout(layoutConfig).run();
        }

        function exportPng() {
            if (cy) {
                const png64 = cy.png({ 
                    full: true, 
                    scale: 2,
                    bg: 'white'
                });
                const link = document.createElement('a');
                link.href = png64;
                link.download = 'sequence-diagram.png';
                link.click();
            } else {
                // Mermaid PNG export fallback
                const diagram = document.getElementById('diagram');
                html2canvas(diagram).then(canvas => {
                    const link = document.createElement('a');
                    link.href = canvas.toDataURL();
                    link.download = 'sequence-diagram.png';
                    link.click();
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initCytoscape();
        });
    </script>
</body>
</html>
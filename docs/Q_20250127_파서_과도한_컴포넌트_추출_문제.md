# Q_파서 과도한 컴포넌트 추출 문제 분석

## 문제 현상

### 1. 과도한 컴포넌트 추출
- **실제 상황**: `ErrorController.java`에 `createUser` 메서드가 1개만 존재
- **파서 결과**: 동일한 `createUser` 메서드가 26개 추출됨
- **전체 현황**: 
  - `Product.java` (249라인) → 1,239개 컴포넌트 추출 (5배 과추출)
  - `User.java` → 1,061개 컴포넌트 추출
  - `ErrorController.java` (110라인) → 130개 컴포넌트 추출

### 2. 중복 관계 생성
- `MixedErrorController -> createUser`: 11개 관계
- `MixedErrorController -> deleteUser`: 11개 관계
- `MixedErrorController -> updateUser`: 11개 관계

### 3. 데이터베이스 현황
- **총 컴포넌트**: 4,324개 (정상적인 수보다 과도하게 많음)
- **중복 관계**: 0개 (중복 제거 완료)
- **과대 건**: 여전히 존재 (잘못된 관계 생성)

## 시도한 해결방안

### 1. 중복 제거 (완료)
- **방법**: 데이터베이스 UNIQUE 제약조건 추가
- **결과**: 중복 관계는 0개로 감소
- **한계**: 근본적인 과추출 문제는 해결되지 않음

### 2. 노이즈 필터링 강화 (완료)
- **방법**: `COMMON_CALL_OBJECTS_TO_IGNORE` 추가
- **결과**: 일부 노이즈 관계 제거
- **한계**: 과추출 문제는 해결되지 않음

### 3. 클래스 추적 로직 수정 (진행 중)
- **방법**: 중괄호 카운팅으로 클래스 범위 추적
- **결과**: 여전히 동일한 문제 발생
- **한계**: 근본적인 원인 파악 부족

## 왜 해결이 안되는지

### 1. 근본 원인 파악 부족
- **문제**: 파서가 왜 동일한 메서드를 26번 추출하는지 정확한 원인 불명
- **추정**: 
  - 동일한 파일이 여러 번 분석되고 있을 가능성
  - 파서 로직의 숨겨진 버그
  - 데이터베이스 저장 과정에서의 문제

### 2. 클래스 추적 로직의 한계
- **현재 구현**: 중괄호 카운팅으로 클래스 범위 추적
- **문제점**: 
  - 문자열 내부의 중괄호 처리 부족
  - 주석 내부의 중괄호 처리 부족
  - 복잡한 Java 문법 처리 부족

### 3. 정규식 기반 분석의 한계
- **현재 방식**: 정규식으로 메서드 추출
- **문제점**: 
  - Java 문법의 복잡성 처리 부족
  - 컨텍스트 정보 부족
  - AST 파서 대비 정확도 부족

## 문제점

### 1. 파서 아키텍처 문제
- **정규식 의존**: 복잡한 Java 문법을 정규식으로만 처리
- **컨텍스트 부족**: 코드의 구조적 정보 부족
- **오류 처리 부족**: 파싱 오류 시 복구 메커니즘 부족

### 2. 디버깅 정보 부족
- **로그 부족**: 파서가 어떤 과정으로 메서드를 추출하는지 추적 불가
- **중간 결과 확인 불가**: 각 단계별 결과를 확인할 수 없음
- **원인 분석 어려움**: 문제 발생 지점 파악 어려움

### 3. 테스트 부족
- **단위 테스트 부족**: 개별 파서 기능 테스트 부족
- **통합 테스트 부족**: 전체 파싱 과정 테스트 부족
- **회귀 테스트 부족**: 수정 후 기존 기능 영향도 확인 부족

## 잘 모르겠는 사항

### 1. 파서 실행 과정
- **질문**: 파서가 정확히 어떤 순서로 파일을 분석하는가?
- **질문**: 동일한 파일이 여러 번 분석되는가?
- **질문**: 메서드 추출 과정에서 중복이 발생하는가?

### 2. 데이터베이스 저장 과정
- **질문**: 컴포넌트 저장 시 중복 체크가 제대로 작동하는가?
- **질문**: 파일별로 독립적으로 저장되는가?
- **질문**: 트랜잭션 처리에 문제가 있는가?

### 3. 클래스 추적 로직
- **질문**: 중괄호 카운팅이 정확하게 작동하는가?
- **질문**: 문자열과 주석 내부의 중괄호를 제대로 처리하는가?
- **질문**: 복잡한 Java 문법을 올바르게 파싱하는가?

### 4. 정규식 패턴
- **질문**: 메서드 추출 정규식이 의도하지 않은 매칭을 하는가?
- **질문**: Java 문법의 예외 케이스를 처리하는가?
- **질문**: 성능상 문제가 있는가?

## 해결 방향

### 1. 근본 원인 파악
- **디버깅 로그 추가**: 파서 실행 과정 상세 로깅
- **단계별 결과 확인**: 각 파싱 단계별 결과 저장 및 확인
- **원인 분석**: 정확한 문제 발생 지점 파악

### 2. 파서 아키텍처 개선
- **AST 파서 도입**: 정규식 대신 AST 파서 사용
- **컨텍스트 정보 강화**: 코드 구조 정보 활용
- **오류 처리 개선**: 파싱 오류 시 복구 메커니즘 추가

### 3. 테스트 강화
- **단위 테스트**: 개별 파서 기능 테스트
- **통합 테스트**: 전체 파싱 과정 테스트
- **회귀 테스트**: 수정 후 기존 기능 영향도 확인

### 4. 모니터링 강화
- **실시간 모니터링**: 파서 실행 과정 실시간 추적
- **성능 모니터링**: 파싱 성능 및 메모리 사용량 모니터링
- **품질 모니터링**: 추출 결과 품질 모니터링

## 결론

현재 문제는 **파서의 과도한 컴포넌트 추출**로 인한 **잘못된 관계 생성**입니다. 

**중복 제거**는 완료되었지만, **근본적인 과추출 문제**는 해결되지 않았습니다.

**정규식 기반 파서의 한계**와 **디버깅 정보 부족**으로 인해 정확한 원인 파악이 어려운 상황입니다.

**AST 파서 도입**과 **파서 아키텍처 전면 개선**이 필요합니다.

---
*작성일: 2025-01-27*  
*작성자: AI Assistant*  
*상태: 해결 필요*
